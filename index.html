<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥–Ω–∞—Ç - –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ */
        :root {
            --primary-blue: #443F75;
            --secondary-blue: #6B63B5;
            --dark-blue: #000000;
            --card-blue: #2A2748;
            --input-blue: #1E1B36;
            --text-white: #FFFFFF;
            --text-gray: #A0A8D0;
            --accent-purple: #8A2BE2;
            --online-green: #00FF88;
            --idle-yellow: #FFAA00;
            --dnd-red: #FF4444;
            --offline-gray: #A0A8D0;
            --success-green: #00CC66;
            --warning-orange: #FFAA00;
            --shadow-blue: rgba(68, 63, 117, 0.3);
            --soft-purple: #A78BFA;
        }

        /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
        [data-theme="light"] {
            --primary-blue: #443F75;
            --secondary-blue: #6B63B5;
            --dark-blue: #F5F7FF;
            --card-blue: #FFFFFF;
            --input-blue: #F8F9FF;
            --text-white: #2D3748;
            --text-gray: #718096;
            --accent-purple: #8A2BE2;
            --online-green: #00CC66;
            --idle-yellow: #DD6B20;
            --dnd-red: #E53E3E;
            --offline-gray: #718096;
            --success-green: #38A169;
            --warning-orange: #DD6B20;
            --shadow-blue: rgba(68, 63, 117, 0.15);
            --soft-purple: #A78BFA;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, var(--dark-blue) 0%, #151A3A 100%);
            color: var(--text-white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        [data-theme="light"] body {
            background: linear-gradient(135deg, var(--dark-blue) 0%, #E6EEFF 100%);
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000 0%, #2A2748 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-logo {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(45deg, #443F75, #6B63B5, #8A2BE2);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #6B63B5;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: var(--text-white);
            font-size: 1.2rem;
            font-weight: 500;
        }

        .loading-dots {
            display: inline-block;
            margin-left: 5px;
        }

        .loading-dots span {
            animation: loadingDots 1.5s infinite;
        }

        .loading-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .loading-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes loadingDots {
            0%, 20% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .custom-scrollbar:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px var(--shadow-blue); }
            50% { box-shadow: 0 0 40px var(--primary-blue), 0 0 60px var(--accent-purple); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes slideOut {
            from { opacity: 1; transform: translateX(0) scale(1); }
            to { opacity: 0; transform: translateX(100%) scale(0.8); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        @keyframes messageAppear {
            from { 
                opacity: 0; 
                transform: translateY(20px) scale(0.8); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes typing {
            0%, 60%, 100% { transform: scale(1); opacity: 0.5; }
            30% { transform: scale(1.2); opacity: 1; }
        }

        /* –ù–æ–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —Ñ–æ–Ω–∞ */
        @keyframes backgroundShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes particleFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.7; }
            25% { transform: translate(10px, -15px) rotate(5deg); opacity: 1; }
            50% { transform: translate(-5px, -25px) rotate(-5deg); opacity: 0.8; }
            75% { transform: translate(-15px, -10px) rotate(3deg); opacity: 0.9; }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤–æ–ª–Ω—ã –¥–ª—è —Ñ–æ–Ω–∞ */
        @keyframes waveAnimation {
            0% { transform: translateX(0) translateY(0) scale(1); opacity: 0.7; }
            50% { transform: translateX(-25%) translateY(-10%) scale(1.05); opacity: 0.9; }
            100% { transform: translateX(-50%) translateY(0) scale(1); opacity: 0.7; }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—É–ª—å—Å–∞—Ü–∏–∏ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        @keyframes sendButtonPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.4);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(167, 139, 250, 0);
            }
        }

        @keyframes sendButtonGlow {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(167, 139, 250, 0.25);
            }
            70% { 
                transform: scale(1);
                box-shadow: 0 0 0 15px rgba(167, 139, 250, 0);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(167, 139, 250, 0);
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –ø–æ–ª—è –≤–≤–æ–¥–∞ */
        @keyframes inputExpand {
            from { 
                height: 48px;
                border-radius: 24px;
                backdrop-filter: blur(5px);
            }
            to { 
                height: 120px;
                border-radius: 20px;
                backdrop-filter: blur(10px);
            }
        }

        @keyframes inputCollapse {
            from { 
                height: 120px;
                border-radius: 20px;
                backdrop-filter: blur(10px);
            }
            to { 
                height: 48px;
                border-radius: 24px;
                backdrop-filter: blur(5px);
            }
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã */
        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-purple));
            transition: .4s;
            border-radius: 34px;
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        input:checked + .theme-slider:before {
            transform: translateX(30px);
            content: "‚òÄÔ∏è";
        }

        input:not(:checked) + .theme-slider:before {
            content: "üåô";
        }

        /* –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
        .landing-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        .background-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #000000, #2A2748, #443F75, #6B63B5);
            background-size: 400% 400%;
            animation: backgroundShift 15s ease infinite;
        }

        .particles-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            background: rgba(107, 99, 181, 0.2);
            border-radius: 50%;
            animation: particleFloat 20s infinite linear;
        }

        .particle:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 10%;
            left: 10%;
            animation-duration: 25s;
        }

        .particle:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            left: 80%;
            animation-duration: 30s;
            animation-delay: 2s;
        }

        .particle:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 80%;
            left: 20%;
            animation-duration: 20s;
            animation-delay: 4s;
        }

        .particle:nth-child(4) {
            width: 100px;
            height: 100px;
            top: 30%;
            left: 70%;
            animation-duration: 35s;
            animation-delay: 1s;
        }

        .particle:nth-child(5) {
            width: 70px;
            height: 70px;
            top: 50%;
            left: 40%;
            animation-duration: 28s;
            animation-delay: 3s;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 0;
            position: relative;
            z-index: 10;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #6B63B5, #8A2BE2);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 30px rgba(107, 99, 181, 0.5);
            animation: glow 3s ease-in-out infinite;
        }

        .nav-links {
            display: flex;
            gap: 35px;
            align-items: center;
        }

        .nav-link {
            color: var(--text-gray);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            position: relative;
            padding: 8px 0;
        }

        .nav-link:hover {
            color: var(--text-white);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--secondary-blue);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        /* 3D –∫–Ω–æ–ø–∫–∏ */
        .btn-3d {
            position: relative;
            padding: 16px 32px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            overflow: hidden;
            transform-style: preserve-3d;
            perspective: 1000px;
        }

        .btn-3d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .btn-3d:hover::before {
            transform: translateX(100%);
        }

        .btn-3d-primary {
            background: linear-gradient(145deg, var(--primary-blue), #3A3665);
            color: white;
            box-shadow: 
                0 10px 20px var(--shadow-blue),
                0 6px 6px rgba(68, 63, 117, 0.2),
                inset 0 -2px 5px rgba(0, 0, 0, 0.2);
            transform: translateY(0);
        }

        .btn-3d-primary:hover {
            transform: translateY(-5px) rotateX(10deg);
            box-shadow: 
                0 15px 30px var(--shadow-blue),
                0 10px 10px rgba(68, 63, 117, 0.3),
                inset 0 -2px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-3d-secondary {
            background: linear-gradient(145deg, var(--card-blue), var(--input-blue));
            color: var(--text-white);
            border: 2px solid rgba(107, 99, 181, 0.3);
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.1),
                0 4px 6px rgba(0, 0, 0, 0.05),
                inset 0 -2px 5px rgba(255, 255, 255, 0.1);
        }

        .btn-3d-secondary:hover {
            transform: translateY(-3px) rotateX(5deg);
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.15),
                0 6px 8px rgba(0, 0, 0, 0.1),
                inset 0 -2px 8px rgba(255, 255, 255, 0.15);
            border-color: var(--secondary-blue);
        }

        /* Hero —Å–µ–∫—Ü–∏—è */
        .hero-section {
            flex: 1;
            display: flex;
            align-items: center;
            padding: 80px 0;
            position: relative;
        }

        .hero-content {
            max-width: 650px;
            animation: slideIn 1s ease-out;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 25px;
            line-height: 1.1;
            background: linear-gradient(45deg, var(--text-white), var(--secondary-blue), var(--accent-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            color: var(--text-gray);
            margin-bottom: 40px;
            line-height: 1.6;
            animation: slideIn 1s ease-out 0.2s both;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 60px;
            animation: slideIn 1s ease-out 0.4s both;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            animation: slideIn 1s ease-out 0.6s both;
        }

        .feature-card {
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            padding: 35px 30px;
            border-radius: 20px;
            border: 1px solid rgba(107, 99, 181, 0.2);
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s ease;
        }

        .feature-card:hover::before {
            left: 100%;
        }

        .feature-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--primary-blue);
            box-shadow: 0 20px 40px var(--shadow-blue);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 25px;
            background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .feature-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-white);
        }

        .feature-description {
            color: var(--text-gray);
            line-height: 1.6;
            font-size: 1rem;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ */
        .auth-container {
            display: none;
            width: 100%;
            min-height: 100vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--card-blue) 100%);
            position: relative;
            overflow: hidden;
        }

        .auth-back {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-white);
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .auth-back:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(-5px);
        }

        .auth-form {
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            padding: 50px 40px;
            border-radius: 25px;
            width: 100%;
            max-width: 480px;
            border: 1px solid rgba(107, 99, 181, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(15px);
            animation: slideIn 0.6s ease-out;
        }

        .auth-form h2 {
            color: var(--text-white);
            margin-bottom: 35px;
            text-align: center;
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-gray);
            font-weight: 600;
            font-size: 1rem;
        }

        .form-group input {
            width: 100%;
            padding: 18px 20px;
            background: var(--input-blue);
            border: 2px solid rgba(107, 99, 181, 0.4);
            border-radius: 12px;
            font-size: 16px;
            color: var(--text-white);
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            border-color: var(--primary-blue);
            outline: none;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px var(--shadow-blue);
        }

        .form-group input.valid {
            border-color: var(--success-green);
        }

        .form-group input.invalid {
            border-color: var(--dnd-red);
        }

        .password-strength {
            margin-top: 12px;
            height: 6px;
            border-radius: 3px;
            background: var(--input-blue);
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
            border-radius: 3px;
        }

        .password-strength.weak .password-strength-bar {
            background: var(--dnd-red);
            width: 33%;
        }

        .password-strength.medium .password-strength-bar {
            background: var(--warning-orange);
            width: 66%;
        }

        .password-strength.strong .password-strength-bar {
            background: var(--success-green);
            width: 100%;
        }

        .password-requirements {
            margin-top: 12px;
            font-size: 0.85rem;
        }

        .requirement {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            color: var(--text-gray);
            transition: all 0.3s;
        }

        .requirement i {
            margin-right: 8px;
            font-size: 0.8rem;
            width: 16px;
            text-align: center;
        }

        .requirement.valid {
            color: var(--success-green);
        }

        .requirement.invalid {
            color: var(--dnd-red);
        }

        .error-message {
            color: var(--dnd-red);
            font-size: 0.9rem;
            margin-top: 8px;
            display: none;
            align-items: center;
            font-weight: 500;
        }

        .error-message i {
            margin-right: 6px;
        }

        .success-message {
            color: var(--success-green);
            font-size: 0.9rem;
            margin-top: 8px;
            display: none;
            align-items: center;
            font-weight: 500;
        }

        .success-message i {
            margin-right: 6px;
        }

        .auth-btn {
            background: linear-gradient(145deg, var(--primary-blue), #3A3665);
            color: white;
            border: none;
            padding: 18px 24px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 20px var(--shadow-blue);
        }

        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px var(--shadow-blue);
        }

        .auth-btn:disabled {
            background: var(--input-blue);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .auth-switch {
            margin-top: 25px;
            text-align: center;
            color: var(--text-gray);
        }

        .auth-switch a {
            color: var(--secondary-blue);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .auth-switch a:hover {
            color: var(--primary-blue);
        }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ */
        .messenger-container {
            display: none;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, var(--dark-blue) 0%, var(--card-blue) 100%);
            position: relative;
            overflow: hidden;
        }

        .messenger-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.05;
        }

        .messenger-floating {
            position: absolute;
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-purple));
            border-radius: 50%;
            animation: float 20s ease-in-out infinite;
        }

        .messenger-floating:nth-child(1) {
            width: 150px;
            height: 150px;
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        .messenger-floating:nth-child(2) {
            width: 100px;
            height: 100px;
            bottom: 20%;
            right: 10%;
            animation-delay: 3s;
        }

        .messenger-floating:nth-child(3) {
            width: 60px;
            height: 60px;
            top: 80%;
            left: 20%;
            animation-delay: 4s;
        }

        .messenger-floating:nth-child(4) {
            width: 100px;
            height: 100px;
            top: 30%;
            left: 70%;
            animation-delay: 1s;
        }

        .messenger-floating:nth-child(5) {
            width: 70px;
            height: 70px;
            top: 50%;
            left: 40%;
            animation-delay: 3s;
        }

        .app-container {
            width: 95%;
            max-width: 1400px;
            height: 90vh;
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            border-radius: 25px;
            overflow: hidden;
            display: flex;
            box-shadow: 0 25px 50px var(--shadow-blue);
            border: 1px solid rgba(107, 99, 181, 0.25);
            margin: 5vh auto;
            animation: slideIn 0.6s ease-out;
            backdrop-filter: blur(10px);
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —á–∞—Ç–æ–≤ - –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –°–¢–ò–õ–¨ */
        .sidebar {
            width: 380px;
            background: linear-gradient(180deg, rgba(42, 39, 72, 0.8), rgba(30, 27, 54, 0.9));
            border-right: 1px solid rgba(107, 99, 181, 0.2);
            display: flex;
            flex-direction: column;
            position: relative;
            backdrop-filter: blur(15px);
        }

        .sidebar-header {
            padding: 25px;
            background: linear-gradient(135deg, rgba(68, 63, 117, 0.3), rgba(107, 99, 181, 0.2));
            border-bottom: 1px solid rgba(107, 99, 181, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue));
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 5px 15px var(--shadow-blue);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }

        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .avatar.online::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--online-green);
            border-radius: 50%;
            border: 2px solid var(--card-blue);
            z-index: 2;
        }

        .avatar.idle::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--idle-yellow);
            border-radius: 50%;
            border: 2px solid var(--card-blue);
            z-index: 2;
        }

        .avatar.dnd::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--dnd-red);
            border-radius: 50%;
            border: 2px solid var(--card-blue);
            z-index: 2;
        }

        .avatar.offline::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--offline-gray);
            border-radius: 50%;
            border: 2px solid var(--card-blue);
            z-index: 2;
        }

        .avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px var(--shadow-blue);
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 700;
            font-size: 1.1rem;
            background: linear-gradient(45deg, var(--text-white), var(--secondary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .user-status {
            font-size: 0.85rem;
            color: var(--online-green);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--online-green);
            animation: pulse 2s infinite;
        }

        .search-container {
            padding: 20px;
            border-bottom: 1px solid rgba(107, 99, 181, 0.15);
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            background: rgba(30, 27, 54, 0.7);
            border: 2px solid rgba(107, 99, 181, 0.3);
            border-radius: 25px;
            font-size: 15px;
            color: var(--text-white);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px var(--shadow-blue);
        }

        .chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .chats-list.custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        .chats-list.custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .chats-list.custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .chats-list.custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .chats-list.custom-scrollbar:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }

        .chat-item {
            padding: 20px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 12px;
            gap: 15px;
            background: linear-gradient(135deg, rgba(30, 27, 54, 0.7), rgba(42, 39, 72, 0.5));
            border: 1px solid rgba(107, 99, 181, 0.1);
            backdrop-filter: blur(10px);
            animation: slideIn 0.3s ease-out;
            position: relative;
        }

        .chat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s ease;
        }

        .chat-item:hover::before {
            left: 100%;
        }

        .chat-item:hover {
            transform: translateX(8px) translateY(-2px);
            border-color: var(--primary-blue);
            box-shadow: 0 15px 30px var(--shadow-blue);
        }

        .chat-item.active {
            background: linear-gradient(135deg, rgba(68, 63, 117, 0.3), rgba(107, 99, 181, 0.2));
            border-color: var(--primary-blue);
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-name {
            font-weight: 700;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-white);
        }

        .last-message {
            color: var(--text-gray);
            font-size: 0.9rem;
            line-height: 1.4;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-time {
            font-size: 0.75rem;
            color: var(--text-gray);
            text-align: right;
            white-space: nowrap;
        }

        .unread-badge {
            background: linear-gradient(45deg, var(--primary-blue), var(--accent-purple));
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: 700;
            min-width: 18px;
            text-align: center;
            box-shadow: 0 2px 8px var(--shadow-blue);
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        .chat-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, var(--input-blue), var(--card-blue));
            position: relative;
        }

        .chat-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            border-bottom: 1px solid rgba(107, 99, 181, 0.2);
            display: flex;
            align-items: center;
            gap: 18px;
            backdrop-filter: blur(10px);
        }

        .chat-messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .chat-messages.custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
        }

        .chat-messages.custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .chat-messages.custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .chat-messages.custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .chat-messages.custom-scrollbar:hover::-webkit-scrollbar-thumb {
            opacity: 1;
        }

        .message {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            position: relative;
            animation: messageAppear 0.4s ease-out;
            backdrop-filter: blur(10px);
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .message.sent {
            background: linear-gradient(135deg, var(--primary-blue), #3A3665);
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 8px;
        }

        .message.received {
            background: linear-gradient(135deg, var(--input-blue), var(--card-blue));
            color: var(--text-white);
            margin-right: auto;
            border-bottom-left-radius: 8px;
            border: 1px solid rgba(107, 99, 181, 0.2);
        }

        .message.pinned {
            border-left: 4px solid var(--warning-orange);
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.1), rgba(255, 170, 0, 0.05));
        }

        .message.reply {
            border-left: 4px solid var(--primary-blue);
        }

        .message:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .message-actions {
            position: absolute;
            top: -10px;
            right: 10px;
            background: var(--card-blue);
            border-radius: 15px;
            padding: 5px;
            display: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .message:hover .message-actions {
            display: flex;
        }

        .message-action {
            background: none;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.8rem;
        }

        .message-action:hover {
            background: var(--input-blue);
            color: var(--text-white);
        }

        .reply-indicator {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary-blue);
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        .reply-sender {
            font-weight: bold;
            color: var(--primary-blue);
        }

        .pinned-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 170, 0, 0.1);
            border-radius: 10px;
            padding: 8px 12px;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: var(--warning-orange);
        }

        /* –ë–ª–æ–∫ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .pinned-message-container {
            background: linear-gradient(135deg, rgba(68, 63, 117, 0.2), rgba(107, 99, 181, 0.1));
            border-radius: 12px;
            padding: 15px;
            margin: 0 30px 15px;
            border-left: 4px solid var(--warning-orange);
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        .pinned-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .pinned-message-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        .pinned-message-content {
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .pinned-message-actions {
            display: flex;
            gap: 10px;
        }

        .pinned-message-action {
            background: none;
            border: none;
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .pinned-message-action:hover {
            color: var(--secondary-blue);
        }

        .file-message {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-top: 8px;
        }

        .file-icon {
            font-size: 1.5rem;
            color: var(--primary-blue);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .file-size {
            font-size: 0.8rem;
            color: var(--text-gray);
        }

        .download-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .download-btn:hover {
            background: var(--secondary-blue);
        }

        .message-time {
            font-size: 0.7rem;
            margin-top: 6px;
            opacity: 0.7;
            text-align: right;
        }

        .message-status {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            margin-top: 4px;
            opacity: 0.8;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--secondary-blue);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        .welcome-message {
            text-align: center;
            color: var(--text-gray);
            margin-top: 100px;
            padding: 40px;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(45deg, var(--text-white), var(--secondary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è - –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –°–¢–ò–õ–¨ */
        .chat-input-container {
            padding: 25px 30px;
            background: linear-gradient(135deg, rgba(42, 39, 72, 0.8), rgba(30, 27, 54, 0.9));
            border-top: 1px solid rgba(107, 99, 181, 0.2);
            display: flex;
            align-items: flex-end;
            gap: 15px;
            backdrop-filter: blur(15px);
            position: relative;
        }

        .chat-input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 15px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .file-upload-container {
            position: relative;
            display: inline-block;
        }

        .file-input {
            position: absolute;
            left: -9999px;
            opacity: 0;
        }

        .message-input-wrapper {
            flex: 1;
            position: relative;
            transition: all 0.3s ease;
        }

        .message-input {
            width: 100%;
            padding: 14px 20px;
            background: rgba(30, 27, 54, 0.7);
            border: 2px solid rgba(107, 99, 181, 0.3);
            border-radius: 24px;
            font-size: 16px;
            color: var(--text-white);
            resize: none;
            max-height: 120px;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(5px);
            line-height: 1.5;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 10px 30px var(--shadow-blue);
        }

        .message-input.expanded {
            animation: inputExpand 0.3s ease-out forwards;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .message-input.collapsed {
            animation: inputCollapse 0.3s ease-in-out forwards;
        }

        .input-cursor { display: none !important; }

        .message-input:focus + .input-cursor { display: none !important; }

        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .action-btn {
            background: linear-gradient(135deg, rgba(30, 27, 54, 0.7), rgba(42, 39, 72, 0.5));
            border: 2px solid rgba(107, 99, 181, 0.2);
            color: var(--text-gray);
            cursor: pointer;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            opacity: 0.7;
            transform: scale(0.9);
        }

        .action-btn.visible {
            opacity: 1;
            transform: scale(1);
        }

        .action-btn:hover {
            background: linear-gradient(135deg, var(--primary-blue), #3A3665);
            border-color: var(--primary-blue);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 15px var(--shadow-blue);
        }

        /* –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –ø—É–ª—å—Å–∞—Ü–∏–µ–π */
        .send-btn {
            background: linear-gradient(135deg, var(--primary-blue), #3A3665);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px var(--shadow-blue);
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .send-btn:hover:not(:disabled) {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 8px 25px var(--shadow-blue);
        }

        .send-btn:disabled {
            background: var(--input-blue);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .send-btn.active {
            animation: sendButtonPulse 2s infinite;
        }

        .send-btn.pulsing::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: transparent;
            border: 2px solid rgba(167, 139, 250, 0.25);
            animation: sendButtonGlow 1s infinite;
            z-index: -1;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border: 1px solid rgba(107, 99, 181, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
        }

        .settings-option {
            margin-bottom: 20px;
        }

        .settings-option label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-gray);
            font-weight: 600;
        }

        .settings-option input, .settings-option select, .settings-option textarea {
            width: 100%;
            padding: 12px 16px;
            background: var(--input-blue);
            border: 2px solid rgba(107, 99, 181, 0.3);
            border-radius: 10px;
            font-size: 16px;
            color: var(--text-white);
        }

        .settings-option input:focus, .settings-option select:focus, .settings-option textarea:focus {
            border-color: var(--primary-blue);
            outline: none;
        }

        .theme-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .theme-label {
            color: var(--text-gray);
            font-weight: 600;
        }

        .avatar-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--input-blue);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 1.2rem;
            background-size: cover;
            background-position: center;
        }

        .avatar-option:hover {
            transform: scale(1.1);
        }

        .avatar-option.selected {
            border: 3px solid var(--primary-blue);
        }

        .avatar-upload {
            margin-top: 20px;
            text-align: center;
        }

        .avatar-upload input {
            display: none;
        }

        .avatar-upload label {
            display: inline-block;
            padding: 10px 20px;
            background: var(--input-blue);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-gray);
        }

        .avatar-upload label:hover {
            background: var(--primary-blue);
            color: white;
        }

        .settings-actions {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }

        .clear-data-btn {
            background: linear-gradient(145deg, var(--dnd-red), #cc3333);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }

        .clear-data-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 68, 68, 0.3);
        }

        /* Ripple —ç—Ñ—Ñ–µ–∫—Ç */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success-green), #00aa55);
            border-left: 4px solid var(--success-green);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--dnd-red), #cc3333);
            border-left: 4px solid var(--dnd-red);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--primary-blue), #3A3665);
            border-left: 4px solid var(--primary-blue);
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ */
        .upload-progress {
            width: 100%;
            height: 4px;
            background: var(--input-blue);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--secondary-blue));
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .uploading {
            opacity: 0.7;
        }

        .uploading .message-content {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±–æ–µ–≤ */
        .wallpaper-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .wallpaper-option {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            aspect-ratio: 16/9;
        }

        .wallpaper-option img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .wallpaper-option:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px var(--shadow-blue);
        }

        .wallpaper-option.selected {
            border: 3px solid var(--primary-blue);
        }

        .wallpaper-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 12px;
            font-size: 0.9rem;
            text-align: center;
            backdrop-filter: blur(5px);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–∫–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .settings-window {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .settings-content {
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(107, 99, 181, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        .settings-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(107, 99, 181, 0.2);
        }

        .settings-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .settings-tab.active {
            color: var(--text-white);
        }

        .settings-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-blue);
        }

        .settings-tab:hover {
            color: var(--text-white);
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .status-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .status-option:hover {
            background: var(--input-blue);
        }

        .status-option.selected {
            border-color: var(--primary-blue);
            background: rgba(68, 63, 117, 0.1);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-indicator.online {
            background: var(--online-green);
        }

        .status-indicator.idle {
            background: var(--idle-yellow);
        }

        .status-indicator.dnd {
            background: var(--dnd-red);
        }

        .status-indicator.offline {
            background: var(--offline-gray);
        }

        .blocked-users-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .blocked-user {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border-radius: 8px;
            background: var(--input-blue);
            margin-bottom: 8px;
        }

        .blocked-user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .blocked-user-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--offline-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .blocked-user-name {
            color: var(--text-gray);
            font-style: italic;
        }

        .unblock-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .unblock-btn:hover {
            background: var(--secondary-blue);
        }

        /* Drag and Drop –∑–æ–Ω–∞ */
        .drop-zone {
            border: 2px dashed var(--primary-blue);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s;
            background: rgba(68, 63, 117, 0.05);
        }

        .drop-zone.active {
            background: rgba(68, 63, 117, 0.1);
            border-color: var(--secondary-blue);
        }

        .drop-zone i {
            font-size: 3rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
        }

        .drop-zone p {
            color: var(--text-gray);
            margin-bottom: 10px;
        }

        .file-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--input-blue);
            border-radius: 10px;
            margin-top: 10px;
        }

        .file-preview img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
        }

        .file-preview-info {
            flex: 1;
        }

        .file-preview-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .file-preview-size {
            font-size: 0.8rem;
            color: var(--text-gray);
        }

        .remove-file {
            background: none;
            border: none;
            color: var(--dnd-red);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é */
        .context-menu {
            position: fixed;
            background: var(--card-blue);
            border: 1px solid rgba(107, 99, 181, 0.3);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 8px 12px;
            background: none;
            border: none;
            color: var(--text-white);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .context-menu-item:hover {
            background: var(--input-blue);
        }

        /* –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø */
        .message-context-menu {
            position: fixed;
            background: var(--card-blue);
            border: 1px solid rgba(107, 99, 181, 0.3);
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            backdrop-filter: blur(10px);
            min-width: 220px;
            animation: slideIn 0.2s ease-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        .message-context-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 10px 12px;
            background: none;
            border: none;
            color: var(--text-white);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
            text-align: left;
        }

        .message-context-menu-item:hover {
            background: var(--input-blue);
            transform: translateX(5px);
        }

        .message-context-menu-item i {
            width: 16px;
            text-align: center;
        }

        .message-context-menu-divider {
            height: 1px;
            background: rgba(107, 99, 181, 0.2);
            margin: 6px 0;
        }

        /* –ö—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π */
        .message-context-menu-item.delete,
        .message-context-menu-item.report {
            color: var(--dnd-red) !important;
        }

        .message-context-menu-item.delete:hover,
        .message-context-menu-item.report:hover {
            background: rgba(255, 68, 68, 0.2) !important;
            color: var(--dnd-red) !important;
        }

        .message-context-menu-item.delete i,
        .message-context-menu-item.report i {
            color: var(--dnd-red) !important;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
        .voice-message-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            margin: 5px 0;
        }

        .voice-message-player {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-waveform {
            flex: 1;
            height: 30px;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .voice-wave-bar {
            width: 3px;
            background: var(--primary-blue);
            border-radius: 2px;
            transition: height 0.2s ease;
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-play-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .voice-play-btn:hover {
            background: var(--secondary-blue);
            transform: scale(1.1);
        }

        .voice-duration {
            font-size: 0.8rem;
            color: var(--text-gray);
            min-width: 40px;
        }

        .voice-speed-selector {
            background: var(--input-blue);
            color: var(--text-white);
            border: 1px solid rgba(107, 99, 181, 0.3);
            border-radius: 5px;
            padding: 3px 6px;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .voice-recording-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255, 0, 0, 0.2);
            border-radius: 20px;
            margin: 5px 0;
            animation: recordingPulse 1.5s infinite;
        }

        .recording-dot {
            width: 12px;
            height: 12px;
            background: var(--dnd-red);
            border-radius: 50%;
        }

        .recording-time {
            font-size: 0.9rem;
            color: var(--text-white);
        }

        .recording-cancel-hint {
            font-size: 0.8rem;
            color: var(--text-gray);
            margin-left: auto;
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–∏—Å–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è */
        .voice-record-btn {
            background: linear-gradient(135deg, var(--input-blue), var(--card-blue));
            border: 2px solid rgba(107, 99, 181, 0.2);
            color: var(--text-gray);
            cursor: pointer;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
            position: relative;
        }

        .voice-record-btn:hover {
            background: linear-gradient(135deg, var(--primary-blue), #3A3665);
            border-color: var(--primary-blue);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 15px var(--shadow-blue);
        }

        .voice-record-btn.recording {
            background: linear-gradient(135deg, var(--dnd-red), #cc3333);
            animation: recordingPulse 1.5s infinite;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ */
        .call-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .call-video-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .remote-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .local-video {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            border-radius: 10px;
            border: 2px solid var(--primary-blue);
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .call-audio-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 40px;
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            border-radius: 20px;
            border: 1px solid rgba(107, 99, 181, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .call-user-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .call-user-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue));
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 2rem;
            margin: 0 auto 15px;
            box-shadow: 0 10px 25px var(--shadow-blue);
        }

        .call-user-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .call-status {
            color: var(--text-gray);
            font-size: 1rem;
        }

        .call-timer {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-white);
            margin: 10px 0;
        }

        .call-controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .call-accept {
            background: linear-gradient(135deg, var(--success-green), #00aa55);
            color: white;
        }

        .call-decline {
            background: linear-gradient(135deg, var(--dnd-red), #cc3333);
            color: white;
        }

        .call-end {
            background: linear-gradient(135deg, var(--dnd-red), #cc3333);
            color: white;
        }

        .call-toggle {
            background: linear-gradient(135deg, var(--input-blue), var(--card-blue));
            color: var(--text-white);
            border: 2px solid rgba(107, 99, 181, 0.3);
        }

        .call-toggle.active {
            background: linear-gradient(135deg, var(--primary-blue), #3A3665);
            border-color: var(--primary-blue);
        }

        .call-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .incoming-call-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1500;
            display: none;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(107, 99, 181, 0.3);
            backdrop-filter: blur(10px);
            animation: bounceIn 0.5s ease-out;
        }

        .incoming-call-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-blue), var(--secondary-blue));
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .incoming-call-info {
            flex: 1;
        }

        .incoming-call-name {
            font-weight: 700;
            margin-bottom: 5px;
        }

        .incoming-call-text {
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        .incoming-call-controls {
            display: flex;
            gap: 10px;
        }

        .call-notification-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –º–∏–∫—Ä–æ-–∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏–π */
        .micro-interaction {
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .micro-interaction:hover {
            transform: translateY(-2px);
        }

        .pulse-notification {
            animation: pulse 2s infinite;
        }

        .parallax-bg {
            transform: translateZ(-1px) scale(1.5);
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-buttons {
                flex-direction: column;
            }
            
            .btn-3d {
                padding: 14px 28px;
                font-size: 1rem;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .app-container {
                flex-direction: column;
                height: 100vh;
                margin: 0;
                border-radius: 0;
            }
            
            .sidebar {
                width: 100%;
                height: 40%;
            }
            
            .chat-content {
                height: 60%;
            }

            .wallpaper-options {
                grid-template-columns: 1fr;
            }

            .settings-content {
                width: 95%;
                padding: 20px;
            }

            .settings-tabs {
                flex-wrap: wrap;
            }

            .settings-tab {
                flex: 1;
                min-width: 120px;
            }

            .message {
                max-width: 85%;
            }

            .local-video {
                width: 120px;
                height: 90px;
            }

            .call-controls {
                gap: 15px;
            }

            .call-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ */
        .wave-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            overflow: hidden;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(107, 99, 181, 0.3) 50%, 
                transparent 100%);
            animation: waveAnimation 15s linear infinite;
            transform-origin: center bottom;
        }

        .wave:nth-child(2) {
            animation-delay: -5s;
            opacity: 0.5;
            height: 80%;
        }

        .wave:nth-child(3) {
            animation-delay: -10s;
            opacity: 0.3;
            height: 60%;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è */
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .confirmation-content {
            background: linear-gradient(135deg, var(--card-blue), var(--input-blue));
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(107, 99, 181, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease-out;
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .confirmation-icon {
            font-size: 3rem;
            color: var(--dnd-red);
            margin-bottom: 20px;
        }

        .confirmation-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--text-white);
        }

        .confirmation-text {
            color: var(--text-gray);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .confirmation-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .confirmation-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            flex: 1;
        }

        .confirmation-btn.cancel {
            background: var(--input-blue);
            color: var(--text-white);
        }

        .confirmation-btn.delete {
            background: linear-gradient(135deg, var(--dnd-red), #cc3333);
            color: white;
        }

        .confirmation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    
/* --- Reactions UI CSS (inserted) --- */
.message-reactions-btn {
    position: absolute;
    bottom: -12px;
    right: 15px;
    background: var(--card-blue);
    padding: 6px 8px;
    border-radius: 12px;
    font-size: 0.85rem;
    color: var(--text-gray);
    cursor: pointer;
    display: none;
    transition: 0.3s;
    z-index: 5;
}

.message:hover .message-reactions-btn {
    display: flex;
    align-items: center;
    gap: 6px;
}

.message-reactions-btn i { font-size: 14px; }

.reactions-menu {
    position: fixed;
    background: var(--card-blue);
    border: 1px solid rgba(107, 99, 181, 0.3);
    border-radius: 12px;
    padding: 8px;
    display: none;
    gap: 10px;
    font-size: 1.2rem;
    z-index: 10000;
    box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    align-items: center;
}

.reactions-menu span {
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 6px;
    transition: 0.12s;
    font-size: 18px;
}

.reactions-menu span:hover {
    background: var(--input-blue);
    transform: translateY(-2px);
}

.reaction-list {
    margin-top: 8px;
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.reaction-item {
    background: rgba(255,255,255,0.06);
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: 0.12s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: var(--text-white);
}

.reaction-item:hover {
    background: rgba(255,255,255,0.12);
    transform: translateY(-2px);
}
/* --- end reactions CSS --- */


/* --- PATCH: Fix reactions overflow --- */
.reaction-list {
    display: flex;
    flex-wrap: wrap;
    max-width: 100%;
    overflow: hidden;
    gap: 6px;
}
.reaction-item {
    white-space: nowrap;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
}
/* --- END PATCH --- */

    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="loading-screen" id="loading-screen">
        <div class="loading-logo">–ò–ì–ù–ê–¢</div>
        <div class="loading-spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞<span class="loading-dots"><span>.</span><span>.</span><span>.</span></span></div>
    </div>

    <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div class="landing-page" id="landing-page">
        <div class="background-animation">
            <div class="particles-container">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
        </div>

        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">–ò–ì–ù–ê–¢</div>
                    <nav class="nav-links">
                        <a href="#" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
                        <a href="#" class="nav-link">–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</a>
                        <a href="#" class="nav-link">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</a>
                        <div class="theme-option">
                            <span class="theme-label">–¢–µ–º–∞</span>
                            <label class="theme-switch">
                                <input type="checkbox" id="theme-toggle">
                                <span class="theme-slider"></span>
                            </label>
                        </div>
                    </nav>
                    <div class="auth-buttons">
                        <button class="btn-3d btn-3d-secondary" id="landing-login-btn">–í–æ–π—Ç–∏</button>
                        <button class="btn-3d btn-3d-primary" id="landing-register-btn">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                    </div>
                </div>
            </div>
        </header>

        <section class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <h1 class="hero-title">–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</h1>
                    <p class="hero-subtitle">–ò–≥–Ω–∞—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –æ–±—â–µ–Ω–∏—è —Å –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç–æ–π –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.</p>
                    <div class="hero-buttons">
                        <button class="btn-3d btn-3d-primary" id="hero-register-btn">–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</button>
                        <button class="btn-3d btn-3d-secondary" id="learn-more-btn">–£–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ</button>
                    </div>
                    
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3 class="feature-title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h3>
                            <p class="feature-description">–í—Å–µ –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞—â–∏—â–µ–Ω—ã —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º. –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ –ø–æ–ª–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h3 class="feature-title">–°–∫–æ—Ä–æ—Å—Ç—å</h3>
                            <p class="feature-description">–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–∞–∂–µ –ø—Ä–∏ –º–µ–¥–ª–µ–Ω–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <h3 class="feature-title">–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å</h3>
                            <p class="feature-description">–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –±–∞–∑–µ. –í—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –≤–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div class="auth-container" id="auth-container">
        <button class="auth-back" id="auth-back-btn">
            <i class="fas fa-arrow-left"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
        </button>
        
        <form class="auth-form" id="login-form">
            <h2>–í—Ö–æ–¥ –≤ –∞–∫–∫–∞—É–Ω—Ç</h2>
            <div class="form-group">
                <label for="login-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à username">
                <div class="error-message" id="login-username-error">
                    <i class="fas fa-exclamation-circle"></i> –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </div>
            </div>
            <div class="form-group">
                <label for="login-password">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –ø–∞—Ä–æ–ª—å">
                <div class="error-message" id="login-password-error">
                    <i class="fas fa-exclamation-circle"></i> –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å
                </div>
            </div>
            <button class="auth-btn" id="login-btn">–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç</button>
            <div class="auth-switch">
                –ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="#" id="switch-to-register">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π</a>
            </div>
        </form>

        <form class="auth-form" id="register-form" style="display: none;">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <div class="form-group">
                <label for="register-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                <input type="text" id="register-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ username (—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)">
                <div class="error-message" id="register-username-error">
                    <i class="fas fa-exclamation-circle"></i> –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã (3-20 —Å–∏–º–≤–æ–ª–æ–≤)
                </div>
                <div class="success-message" id="register-username-success">
                    <i class="fas fa-check-circle"></i> –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ
                </div>
            </div>
            <div class="form-group">
                <label for="register-password">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="register-password" placeholder="–°–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å">
                <div class="password-strength" id="password-strength">
                    <div class="password-strength-bar"></div>
                </div>
                <div class="password-requirements">
                    <div class="requirement" id="length-req">
                        <i class="fas fa-times"></i> –ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤
                    </div>
                    <div class="requirement" id="lowercase-req">
                        <i class="fas fa-times"></i> –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã
                    </div>
                    <div class="requirement" id="uppercase-req">
                        <i class="fas fa-times"></i> –°–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã
                    </div>
                    <div class="requirement" id="number-req">
                        <i class="fas fa-times"></i> –°–æ–¥–µ—Ä–∂–∏—Ç —Ü–∏—Ñ—Ä—ã
                    </div>
                    <div class="requirement" id="special-req">
                        <i class="fas fa-times"></i> –°–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
                    </div>
                </div>
                <div class="error-message" id="register-password-error">
                    <i class="fas fa-exclamation-circle"></i> –ü–∞—Ä–æ–ª—å –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
                </div>
            </div>
            <div class="form-group">
                <label for="confirm-password">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
                <input type="password" id="confirm-password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                <div class="error-message" id="confirm-password-error">
                    <i class="fas fa-exclamation-circle"></i> –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
                </div>
            </div>
            <button class="auth-btn" id="register-btn" disabled>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            <div class="auth-switch">
                –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="#" id="switch-to-login">–í–æ–π—Ç–∏</a>
            </div>
        </form>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <div class="messenger-container" id="messenger-container">
        <div class="wave-background">
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
        </div>
        
        <div class="app-container">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å —á–∞—Ç–∞–º–∏ -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="user-info">
                        <div class="avatar online" id="user-avatar">U</div>
                        <div class="user-details">
                            <div class="user-name" id="user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                            <div class="user-status">
                                <span class="status-dot"></span> –æ–Ω–ª–∞–π–Ω
                            </div>
                        </div>
                    </div>
                    <div>
                        <button class="btn-3d btn-3d-secondary" id="settings-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="btn-3d btn-3d-secondary" id="logout-btn" title="–í—ã–π—Ç–∏">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
                
                <div class="search-container">
                    <input type="text" class="search-input" id="global-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
                </div>
                
                <div class="chats-list custom-scrollbar" id="chats-list">
                    <div class="welcome-message">
                        <div class="welcome-title">–í–∞—à–∏ —á–∞—Ç—ã</div>
                        <div class="welcome-subtitle">–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –≤–∞—à–∏ –±–µ—Å–µ–¥—ã</div>
                    </div>
                </div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
            <div class="chat-content">
                <div class="chat-header">
                    <div class="avatar" id="current-chat-avatar">?</div>
                    <div class="user-details">
                        <div class="user-name" id="current-chat-name">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</div>
                        <div class="user-status" id="current-chat-status">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ</div>
                    </div>
                    <div class="call-buttons" style="margin-left: auto; display: flex; gap: 10px;">
                        <button class="action-btn" id="audio-call-btn" title="–ê—É–¥–∏–æ–∑–≤–æ–Ω–æ–∫">
                            <i class="fas fa-phone"></i>
                        </button>
                        <button class="action-btn" id="video-call-btn" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫">
                            <i class="fas fa-video"></i>
                        </button>
                    </div>
                </div>
                
                <!-- –ë–ª–æ–∫ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                <div class="pinned-message-container" id="pinned-message-container">
                    <div class="pinned-message-header">
                        <div class="pinned-message-info">
                            <i class="fas fa-thumbtack"></i>
                            <span>–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
                        </div>
                        <button class="pinned-message-action" id="unpin-message-btn">
                            <i class="fas fa-times"></i>
                            –û—Ç–∫—Ä–µ–ø–∏—Ç—å
                        </button>
                    </div>
                    <div class="pinned-message-content" id="pinned-message-content">
                        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
                    </div>
                    <div class="pinned-message-actions">
                        <button class="pinned-message-action" id="show-in-chat-btn">
                            <i class="fas fa-arrow-down"></i>
                            –ü–æ–∫–∞–∑–∞—Ç—å –≤ —á–∞—Ç–µ
                        </button>
                    </div>
                </div>
                
                <div class="chat-messages custom-scrollbar" id="chat-messages">
                    <div class="welcome-message">
                        <div class="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–≥–Ω–∞—Ç!</div>
                        <div class="welcome-subtitle">
                            <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞ –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é –±–µ—Å–µ–¥—É</p>
                            <p>–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>
                        </div>
                    </div>
                </div>
                
                <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
                <div class="chat-input-container">
                    <div class="chat-input-wrapper">
                        <div class="file-upload-container">
                            <input type="file" id="file-input" class="file-input" multiple>
                            <button class="action-btn" id="file-btn" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">
                                <i class="fas fa-paperclip"></i>
                            </button>
                        </div>
                        <button class="action-btn" id="voice-record-btn" title="–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="action-btn" id="emoji-btn" title="–≠–º–æ–¥–∑–∏">
                            <i class="fas fa-smile"></i>
                        </button>
                        <div class="message-input-wrapper">
                            <textarea class="message-input" id="message-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="1" disabled></textarea>
                        </div>
                        <button class="send-btn" id="send-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="settings-window" id="settings-window">
        <div class="settings-content custom-scrollbar">
            <div class="modal-header">
                <h3 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <button class="close-modal" id="close-settings-btn">&times;</button>
            </div>
            
            <div class="settings-tabs">
                <button class="settings-tab active" data-tab="profile">–ü—Ä–æ—Ñ–∏–ª—å</button>
                <button class="settings-tab" data-tab="appearance">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</button>
                <button class="settings-tab" data-tab="notifications">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
                <button class="settings-tab" data-tab="privacy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</button>
            </div>
            
            <div class="settings-panel active" id="profile-panel">
                <div class="settings-option">
                    <label>–°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞</label>
                    <div class="avatar-options">
                        <div class="avatar-option" data-avatar="AL">AL</div>
                        <div class="avatar-option" data-avatar="MA">MA</div>
                        <div class="avatar-option" data-avatar="DM">DM</div>
                        <div class="avatar-option" data-avatar="AN">AN</div>
                    </div>
                    <div class="avatar-upload">
                        <input type="file" id="avatar-upload" accept="image/*">
                        <label for="avatar-upload">
                            <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é –∞–≤–∞—Ç–∞—Ä–∫—É
                        </label>
                    </div>
                </div>

                <div class="settings-option">
                    <label for="display-name">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="display-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                </div>

                <div class="settings-option">
                    <label for="user-bio">–û —Å–µ–±–µ</label>
                    <textarea id="user-bio" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..." rows="3"></textarea>
                </div>

                <div class="settings-option">
                    <label>–°—Ç–∞—Ç—É—Å</label>
                    <div class="status-options">
                        <div class="status-option selected" data-status="online">
                            <div class="status-indicator online"></div>
                            <span>–í —Å–µ—Ç–∏</span>
                        </div>
                        <div class="status-option" data-status="idle">
                            <div class="status-indicator idle"></div>
                            <span>–ù–µ –∞–∫—Ç–∏–≤–µ–Ω</span>
                        </div>
                        <div class="status-option" data-status="dnd">
                            <div class="status-indicator dnd"></div>
                            <span>–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å</span>
                        </div>
                        <div class="status-option" data-status="offline">
                            <div class="status-indicator offline"></div>
                            <span>–ù–µ –≤ —Å–µ—Ç–∏</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-panel" id="appearance-panel">
                <div class="theme-option">
                    <span class="theme-label">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</span>
                    <label class="theme-switch">
                        <input type="checkbox" id="theme-setting">
                        <span class="theme-slider"></span>
                    </label>
                </div>

                <div class="settings-option">
                    <label>–û–±–æ–∏ —á–∞—Ç–∞</label>
                    <div class="wallpaper-options" id="wallpaper-options">
                        <div class="wallpaper-option" data-wallpaper="default">
                            <div style="background: var(--input-blue); width: 100%; height: 100%;"></div>
                            <div class="wallpaper-name">–°—Ç–∞–Ω–¥–∞—Ä—Ç</div>
                        </div>
                        <div class="wallpaper-option" data-wallpaper="mountains">
                            <img src="https://upload-santon.website.yandexcloud.net/upload/product_brand_zone/stworki_bg.png" alt="–ì–æ—Ä—ã">
                            <div class="wallpaper-name">–ì–æ—Ä—ã</div>
                        </div>
                        <div class="wallpaper-option" data-wallpaper="city">
                            <img src="https://abrakadabra.fun/uploads/posts/2021-12/1640829007_5-abrakadabra-fun-p-zadnii-fon-dlya-telegramma-7.jpg" alt="–ì–æ—Ä–æ–¥">
                            <div class="wallpaper-name">–ì–æ—Ä–æ–¥</div>
                        </div>
                        <div class="wallpaper-option" data-wallpaper="night-city">
                            <img src="https://avatars.mds.yandex.net/get-mpic/4585707/img_id5666812481143380860.jpeg/orig" alt="–ù–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥">
                            <div class="wallpaper-name">–ù–æ—á–Ω–æ–π –≥–æ—Ä–æ–¥</div>
                        </div>
                        <div class="wallpaper-option" data-wallpaper="plain">
                            <div style="background: linear-gradient(135deg, #1A1F3E, #252A4A); width: 100%; height: 100%;"></div>
                            <div class="wallpaper-name">–ü—É—Å—Ç–æ</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-panel" id="notifications-panel">
                <div class="settings-option">
                    <label for="notifications-setting">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                    <select id="notifications-setting">
                        <option value="all">–í—Å–µ</option>
                        <option value="mentions">–¢–æ–ª—å–∫–æ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è</option>
                        <option value="none">–û—Ç–∫–ª—é—á–∏—Ç—å</option>
                    </select>
                </div>

                <div class="settings-option">
                    <label for="sound-setting">–ó–≤—É–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</label>
                    <select id="sound-setting">
                        <option value="enabled">–í–∫–ª—é—á–µ–Ω—ã</option>
                        <option value="disabled">–û—Ç–∫–ª—é—á–µ–Ω—ã</option>
                    </select>
                </div>
            </div>
            
            <div class="settings-panel" id="privacy-panel">
                <div class="settings-option">
                    <label for="privacy-setting">–ö—Ç–æ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –≤–∞–º</label>
                    <select id="privacy-setting">
                        <option value="all">–í—Å–µ</option>
                        <option value="contacts">–¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã</option>
                        <option value="nobody">–ù–∏–∫—Ç–æ</option>
                    </select>
                </div>
                
                <div class="settings-option">
                    <label for="last-seen-setting">–ö—Ç–æ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è</label>
                    <select id="last-seen-setting">
                        <option value="all">–í—Å–µ</option>
                        <option value="contacts">–¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã</option>
                        <option value="nobody">–ù–∏–∫—Ç–æ</option>
                    </select>
                </div>

                <div class="settings-option">
                    <label>–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</label>
                    <div class="blocked-users-list" id="blocked-users-list">
                        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>

            <div class="settings-actions">
                <button class="btn-3d btn-3d-primary" id="save-settings-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="clear-data-btn" id="clear-data-btn">–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                <button class="btn-3d btn-3d-secondary" id="cancel-settings-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <div class="modal" id="file-upload-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
                <button class="close-modal" id="close-file-upload-btn">&times;</button>
            </div>
            
            <div class="drop-zone" id="drop-zone">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</p>
                <p>–∏–ª–∏</p>
                <button class="btn-3d btn-3d-primary" id="browse-files-btn">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã</button>
            </div>
            
            <div id="file-previews">
                <!-- –ü—Ä–µ–≤—å—é —Ñ–∞–π–ª–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∑–¥–µ—Å—å -->
            </div>
            
            <div class="settings-actions">
                <button class="btn-3d btn-3d-primary" id="send-files-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <button class="btn-3d btn-3d-secondary" id="cancel-file-upload-btn">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div class="confirmation-modal" id="delete-confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="confirmation-title">–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ?</h3>
            <p class="confirmation-text">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            <div class="confirmation-actions">
                <button class="confirmation-btn cancel" id="cancel-delete-btn">–û—Ç–º–µ–Ω–∞</button>
                <button class="confirmation-btn delete" id="confirm-delete-btn">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ -->
    <div class="call-container" id="call-container">
        <div class="call-video-container" id="video-call-container" style="display: none;">
            <video class="remote-video" id="remote-video" autoplay playsinline></video>
            <video class="local-video" id="local-video" autoplay playsinline muted></video>
            <div class="call-controls" style="position: absolute; bottom: 20px; left: 0; right: 0; display: flex; justify-content: center;">
                <button class="call-btn call-toggle" id="video-toggle-btn" title="–í—ã–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ">
                    <i class="fas fa-video"></i>
                </button>
                <button class="call-btn call-toggle" id="audio-toggle-btn" title="–í—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="call-btn call-end" id="end-call-btn" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
            <div class="call-timer" style="position: absolute; top: 20px; left: 0; right: 0; text-align: center;">00:00</div>
        </div>
        
        <div class="call-audio-container" id="audio-call-container" style="display: none;">
            <div class="call-user-info">
                <div class="call-user-avatar" id="call-user-avatar">U</div>
                <div class="call-user-name" id="call-user-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                <div class="call-status" id="call-status">–ó–≤–æ–Ω–æ–∫...</div>
                <div class="call-timer" id="call-timer">00:00</div>
            </div>
            <div class="call-controls">
                <button class="call-btn call-toggle" id="audio-call-toggle-btn" title="–í—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">
                    <i class="fas fa-microphone"></i>
                </button>
                <button class="call-btn call-end" id="end-audio-call-btn" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
        
        <div class="call-audio-container" id="incoming-call-container" style="display: none;">
            <div class="call-user-info">
                <div class="call-user-avatar" id="incoming-call-avatar">U</div>
                <div class="call-user-name" id="incoming-call-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                <div class="call-status" id="incoming-call-type">–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫</div>
            </div>
            <div class="call-controls">
                <button class="call-btn call-accept" id="accept-call-btn" title="–ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="call-btn call-decline" id="decline-call-btn" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
                    <i class="fas fa-phone-slash"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—Ö–æ–¥—è—â–µ–º –∑–≤–æ–Ω–∫–µ -->
    <div class="incoming-call-notification" id="incoming-call-notification" style="display: none;">
        <div class="incoming-call-avatar" id="notification-call-avatar">U</div>
        <div class="incoming-call-info">
            <div class="incoming-call-name" id="notification-call-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
            <div class="incoming-call-text" id="notification-call-type">–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫</div>
        </div>
        <div class="incoming-call-controls">
            <button class="call-notification-btn call-accept" id="notification-accept-btn" title="–ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫">
                <i class="fas fa-phone"></i>
            </button>
            <button class="call-notification-btn call-decline" id="notification-decline-btn" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫">
                <i class="fas fa-phone-slash"></i>
            </button>
        </div>
    </div>

    <!-- Reactions menu -->
    <div id="reactions-menu" class="reactions-menu" aria-hidden="true">
        <span data-reaction="üëç" title="–õ–∞–π–∫">üëç</span>
        <span data-reaction="‚ù§Ô∏è" title="–°–µ—Ä–¥–µ—á–∫–æ">‚ù§Ô∏è</span>
        <span data-reaction="üî•" title="–û–≥–æ–Ω—ë–∫">üî•</span>
        <span data-reaction="üëé" title="–î–∏–∑–ª–∞–π–∫">üëé</span>
        <span data-reaction="ü§°" title="–ö–ª–æ—É–Ω">ü§°</span>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
        const SUPABASE_URL = 'https://uwaserqrrgziltmfhuls.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV3YXNlcnFycmd6aWx0bWZodWxzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNzU5MDEsImV4cCI6MjA3ODk1MTkwMX0.3rAslm271cqT-vHYARVO0xmpY-sFtKy3N6wQy_jLR_Y';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase –≤–º–µ—Å—Ç–æ localStorage
        class IgnatDB {
            constructor() {
                this.supabase = supabase;
            }

            async addUser(user) {
                const { data, error } = await this.supabase
                    .from('users')
                    .insert([user])
                    .select();
                
                if (error) {
                    console.error('Error creating user:', error);
                    throw error;
                }
                return data[0];
            }

            async getUserByUsername(username) {
                const { data, error } = await this.supabase
                    .from('users')
                    .select('*')
                    .eq('username', username)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('Error fetching user:', error);
                }
                return data;
            }

            async getUserById(userId) {
                const { data, error } = await this.supabase
                    .from('users')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error) {
                    console.error('Error fetching user by ID:', error);
                    return null;
                }
                return data;
            }

            async getAllUsers() {
                const { data, error } = await this.supabase
                    .from('users')
                    .select('*');
                
                if (error) {
                    console.error('Error fetching users:', error);
                    return [];
                }
                return data || [];
            }

            async searchUsers(query) {
                const { data, error } = await this.supabase
                    .from('users')
                    .select('*')
                    .ilike('username', `%${query}%`);
                
                if (error) {
                    console.error('Error searching users:', error);
                    return [];
                }
                return data || [];
            }

            async updateUser(userId, updates) {
                const { data, error } = await this.supabase
                    .from('users')
                    .update(updates)
                    .eq('id', userId)
                    .select();
                
                if (error) {
                    console.error('Error updating user:', error);
                    return null;
                }
                return data[0];
            }

            async getSettings(userId) {
                const { data, error } = await this.supabase
                    .from('user_settings')
                    .select('*')
                    .eq('user_id', userId)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('Error fetching settings:', error);
                }
                return data ? data.settings : {};
            }

            async saveSettings(userId, newSettings) {
                const { data, error } = await this.supabase
                    .from('user_settings')
                    .upsert({
                        user_id: userId,
                        settings: newSettings,
                        updated_at: new Date().toISOString()
                    });
                
                if (error) {
                    console.error('Error saving settings:', error);
                }
            }

            async addChat(chat) {
                const { data, error } = await this.supabase
                    .from('chats')
                    .insert([chat])
                    .select();
                
                if (error) {
                    console.error('Error creating chat:', error);
                    return null;
                }
                return data[0];
            }

            async getChat(chatId) {
                const { data, error } = await this.supabase
                    .from('chats')
                    .select('*')
                    .eq('id', chatId)
                    .single();
                
                if (error) {
                    console.error('Error fetching chat:', error);
                    return null;
                }
                return data;
            }

            async getUserChats(userId) {
                const { data, error } = await this.supabase
                    .from('chats')
                    .select('*')
                    .contains('participants', [userId]);
                
                if (error) {
                    console.error('Error fetching user chats:', error);
                    return [];
                }
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                return (data || []).sort((a, b) => 
                    new Date(b.last_message_time || b.created_at) - new Date(a.last_message_time || a.created_at)
                );
            }

            async findChatBetweenUsers(user1Id, user2Id) {
                const { data, error } = await this.supabase
                    .from('chats')
                    .select('*')
                    .contains('participants', [user1Id, user2Id])
                    .eq('is_group', false);
                
                if (error) {
                    console.error('Error finding chat:', error);
                    return null;
                }
                return data && data.length > 0 ? data[0] : null;
            }

            async updateChat(chatId, updates) {
                const { data, error } = await this.supabase
                    .from('chats')
                    .update(updates)
                    .eq('id', chatId)
                    .select();
                
                if (error) {
                    console.error('Error updating chat:', error);
                    return null;
                }
                return data[0];
            }

            async addMessage(message) {
                const { data, error } = await this.supabase
                    .from('messages')
                    .insert([message])
                    .select();
                
                if (error) {
                    console.error('Error adding message:', error);
                    return null;
                }
                return data[0];
            }

            async getChatMessages(chatId) {
                const { data, error } = await this.supabase
                    .from('messages')
                    .select('*')
                    .eq('chat_id', chatId)
                    .order('created_at', { ascending: true });
                
                if (error) {
                    console.error('Error fetching messages:', error);
                    return [];
                }
                return data || [];
            }

            async getLastMessage(chatId) {
                const { data, error } = await this.supabase
                    .from('messages')
                    .select('*')
                    .eq('chat_id', chatId)
                    .order('created_at', { ascending: false })
                    .limit(1)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('Error fetching last message:', error);
                }
                return data;
            }

            async updateMessage(messageId, updates) {
                const { data, error } = await this.supabase
                    .from('messages')
                    .update(updates)
                    .eq('id', messageId)
                    .select();
                
                if (error) {
                    console.error('Error updating message:', error);
                    return null;
                }
                return data[0];
            }

            async addFile(file) {
                const { data, error } = await this.supabase
                    .from('files')
                    .insert([file])
                    .select();
                
                if (error) {
                    console.error('Error adding file:', error);
                    return null;
                }
                return data[0];
            }

            async getFile(fileId) {
                const { data, error } = await this.supabase
                    .from('files')
                    .select('*')
                    .eq('id', fileId)
                    .single();
                
                if (error) {
                    console.error('Error fetching file:', error);
                    return null;
                }
                return data;
            }

            async addVoiceMessage(voiceMessage) {
                const { data, error } = await this.supabase
                    .from('voice_messages')
                    .insert([voiceMessage])
                    .select();
                
                if (error) {
                    console.error('Error adding voice message:', error);
                    return null;
                }
                return data[0];
            }

            async getChatVoiceMessages(chatId) {
                const { data, error } = await this.supabase
                    .from('voice_messages')
                    .select('*')
                    .eq('chat_id', chatId)
                    .order('created_at', { ascending: true });
                
                if (error) {
                    console.error('Error fetching voice messages:', error);
                    return [];
                }
                return data || [];
            }

            async blockUser(userId, targetUserId) {
                const { error } = await this.supabase
                    .from('blocked_users')
                    .insert({
                        user_id: userId,
                        blocked_user_id: targetUserId,
                        created_at: new Date().toISOString()
                    });
                
                if (error) {
                    console.error('Error blocking user:', error);
                }
            }

            async unblockUser(userId, targetUserId) {
                const { error } = await this.supabase
                    .from('blocked_users')
                    .delete()
                    .eq('user_id', userId)
                    .eq('blocked_user_id', targetUserId);
                
                if (error) {
                    console.error('Error unblocking user:', error);
                }
            }

            async getBlockedUsers(userId) {
                const { data, error } = await this.supabase
                    .from('blocked_users')
                    .select('blocked_user_id')
                    .eq('user_id', userId);
                
                if (error) {
                    console.error('Error fetching blocked users:', error);
                    return [];
                }
                return data.map(item => item.blocked_user_id);
            }

            async isUserBlocked(userId, targetUserId) {
                const { data, error } = await this.supabase
                    .from('blocked_users')
                    .select('id')
                    .eq('user_id', userId)
                    .eq('blocked_user_id', targetUserId)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('Error checking if user is blocked:', error);
                }
                return !!data;
            }

            async pinMessage(chatId, messageId) {
                const { data, error } = await this.supabase
                    .from('pinned_messages')
                    .upsert({
                        chat_id: chatId,
                        message_id: messageId,
                        pinned_at: new Date().toISOString()
                    })
                    .select();
                
                if (error) {
                    console.error('Error pinning message:', error);
                    return null;
                }
                return data[0];
            }

            async unpinMessage(chatId) {
                const { error } = await this.supabase
                    .from('pinned_messages')
                    .delete()
                    .eq('chat_id', chatId);
                
                if (error) {
                    console.error('Error unpinning message:', error);
                }
            }

            async getPinnedMessage(chatId) {
                const { data, error } = await this.supabase
                    .from('pinned_messages')
                    .select('message_id')
                    .eq('chat_id', chatId)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('Error fetching pinned message:', error);
                    return null;
                }
                
                if (data) {
                    return this.getMessageById(data.message_id);
                }
                return null;
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ ID
            async getMessageById(messageId) {
                const { data, error } = await this.supabase
                    .from('messages')
                    .select('*')
                    .eq('id', messageId)
                    .single();
                
                if (error) {
                    console.error('Error fetching message by ID:', error);
                    return null;
                }
                return data;
            }

            // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π)
            async clearDatabase() {
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω–∞
                // –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
                console.warn('Database clear function called - this would delete all data in a real app');
            }
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        function validateUsername(username) {
            const regex = /^[a-zA-Z0-9]{3,20}$/;
            return regex.test(username);
        }

        function checkPasswordStrength(password) {
            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                lowercase: /[a-z]/.test(password),
                uppercase: /[A-Z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[^a-zA-Z0-9]/.test(password)
            };

            strength = Object.values(requirements).filter(req => req).length;

            return {
                strength: strength,
                requirements: requirements
            };
        }

        function updatePasswordRequirements(requirements) {
            const reqIds = ['length', 'lowercase', 'uppercase', 'number', 'special'];
            reqIds.forEach(id => {
                const element = document.getElementById(`${id}-req`);
                const icon = element.querySelector('i');
                
                if (requirements[id]) {
                    element.classList.add('valid');
                    element.classList.remove('invalid');
                    icon.className = 'fas fa-check';
                } else {
                    element.classList.add('invalid');
                    element.classList.remove('valid');
                    icon.className = 'fas fa-times';
                }
            });
        }

        function updatePasswordStrength(strength) {
            const strengthBar = document.getElementById('password-strength');
            strengthBar.className = 'password-strength';
            
            if (strength <= 2) {
                strengthBar.classList.add('weak');
            } else if (strength <= 4) {
                strengthBar.classList.add('medium');
            } else {
                strengthBar.classList.add('strong');
            }
        }

        function validateRegistrationForm() {
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            const isUsernameValid = validateUsername(username);
            const passwordCheck = checkPasswordStrength(password);
            const isPasswordValid = passwordCheck.strength >= 3;
            const isConfirmValid = password === confirmPassword && password !== '';
            
            document.getElementById('register-username').className = isUsernameValid ? 'valid' : 'invalid';
            document.getElementById('register-password').className = isPasswordValid ? 'valid' : 'invalid';
            document.getElementById('confirm-password').className = isConfirmValid ? 'valid' : 'invalid';
            
            document.getElementById('register-btn').disabled = !(isUsernameValid && isPasswordValid && isConfirmValid);
            
            return isUsernameValid && isPasswordValid && isConfirmValid;
        }

        function validateLoginForm() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            const isUsernameValid = username.length >= 3;
            const isPasswordValid = password.length >= 1;
            
            document.getElementById('login-username').className = isUsernameValid ? 'valid' : 'invalid';
            document.getElementById('login-password').className = isPasswordValid ? 'valid' : 'invalid';
            
            document.getElementById('login-username-error').style.display = isUsernameValid ? 'none' : 'flex';
            document.getElementById('login-password-error').style.display = isPasswordValid ? 'none' : 'flex';
            
            document.getElementById('login-btn').disabled = !(isUsernameValid && isPasswordValid);
            
            return isUsernameValid && isPasswordValid;
        }

        // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏
        function formatLastSeen(lastSeen) {
            if (!lastSeen) return '–Ω–∏–∫–æ–≥–¥–∞';
            
            const now = new Date();
            const lastSeenDate = new Date(lastSeen);
            const diffMs = now - lastSeenDate;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
            if (diffHours < 24) return `${diffHours} —á –Ω–∞–∑–∞–¥`;
            if (diffDays < 7) return `${diffDays} –¥ –Ω–∞–∑–∞–¥`;
            
            return lastSeenDate.toLocaleDateString('ru-RU');
        }

        function isUserOnline(lastSeen) {
            if (!lastSeen) return false;
            const now = new Date();
            const lastSeenDate = new Date(lastSeen);
            return (now - lastSeenDate) < 300000;
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–æ–π
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('ignat_theme', theme);
        }

        function getTheme() {
            return localStorage.getItem('ignat_theme') || 'dark';
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±–æ—è–º–∏
        function setWallpaper(wallpaper) {
            const chatContent = document.querySelector('.chat-content');
            chatContent.style.background = '';
            chatContent.style.backgroundSize = '';
            chatContent.style.backgroundPosition = '';
            
            switch(wallpaper) {
                case 'mountains':
                    chatContent.style.background = `url('https://upload-santon.website.yandexcloud.net/upload/product_brand_zone/stworki_bg.png')`;
                    chatContent.style.backgroundSize = 'cover';
                    chatContent.style.backgroundPosition = 'center';
                    break;
                case 'city':
                    chatContent.style.background = `url('https://abrakadabra.fun/uploads/posts/2021-12/1640829007_5-abrakadabra-fun-p-zadnii-fon-dlya-telegramma-7.jpg')`;
                    chatContent.style.backgroundSize = 'cover';
                    chatContent.style.backgroundPosition = 'center';
                    break;
                case 'night-city':
                    chatContent.style.background = `url('https://avatars.mds.yandex.net/get-mpic/4585707/img_id5666812481143380860.jpeg/orig')`;
                    chatContent.style.backgroundSize = 'cover';
                    chatContent.style.backgroundPosition = 'center';
                    break;
                case 'plain':
                    chatContent.style.background = 'linear-gradient(135deg, #1A1F3E, #252A4A)';
                    break;
                default:
                    chatContent.style.background = 'linear-gradient(135deg, var(--input-blue), var(--card-blue))';
            }
            
            localStorage.setItem('ignat_wallpaper', wallpaper);
        }

        function getWallpaper() {
            return localStorage.getItem('ignat_wallpaper') || 'default';
        }

        // Ripple —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function createRipple(event) {
            const button = event.currentTarget;
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;

            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
            circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
            circle.classList.add('ripple');

            const ripple = button.getElementsByClassName('ripple')[0];
            if (ripple) {
                ripple.remove();
            }

            button.appendChild(circle);
        }

        // –ö—Ä–∞—Å–∏–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'}"></i>
                ${message}
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∑–≤–æ–Ω–∫–æ–≤
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–æ–ª–Ω—ã
        function generateWaveformData(length) {
            const data = [];
            for (let i = 0; i < length; i++) {
                data.push(Math.random() * 30 + 5);
            }
            return data;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const db = new IgnatDB();
        let currentUser = null;
        let currentChat = null;
        let updateInterval = null;
        let replyingToMessage = null;
        let pinnedMessage = null;
        let filesToSend = [];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let recordingStartTime = null;
        let recordingTimer = null;
        let voiceMessages = {};

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
        let localStream = null;
        let remoteStream = null;
        let peerConnection = null;
        let callTimer = null;
        let callStartTime = null;
        let isInCall = false;
        let isVideoCall = false;
        let isAudioMuted = false;
        let isVideoMuted = false;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        let contextMenuMessage = null;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª—è –≤–≤–æ–¥–∞
        let isInputExpanded = false;
        let inputAnimationTimeout = null;

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const loadingScreen = document.getElementById('loading-screen');
        const landingPage = document.getElementById('landing-page');
        const authContainer = document.getElementById('auth-container');
        const messengerContainer = document.getElementById('messenger-container');
        const settingsWindow = document.getElementById('settings-window');
        const callContainer = document.getElementById('call-container');
        const incomingCallNotification = document.getElementById('incoming-call-notification');
        const deleteConfirmationModal = document.getElementById('delete-confirmation-modal');
        const pinnedMessageContainer = document.getElementById('pinned-message-container');
        const pinnedMessageContent = document.getElementById('pinned-message-content');

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
        async function displayPinnedMessage(chatId) {
            const pinnedMsg = await db.getPinnedMessage(chatId);
            if (pinnedMsg) {
                pinnedMessage = pinnedMsg;
                pinnedMessageContainer.style.display = 'block';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                let content = '';
                if (pinnedMsg.file) {
                    content = `
                        <div class="file-message">
                            <div class="file-icon">
                                <i class="fas fa-${getFileIcon(pinnedMsg.file.type)}"></i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">${pinnedMsg.file.name}</div>
                                <div class="file-size">${formatFileSize(pinnedMsg.file.size)}</div>
                            </div>
                        </div>
                    `;
                } else {
                    content = `<div>${pinnedMsg.text}</div>`;
                }
                
                pinnedMessageContent.innerHTML = content;
            } else {
                pinnedMessageContainer.style.display = 'none';
                pinnedMessage = null;
            }
        }

        async function pinMessage(messageId) {
            if (!currentChat) return;
            
            const message = await db.getMessageById(messageId);
            if (!message) return;
            
            // –°–Ω–∏–º–∞–µ–º –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            await db.unpinMessage(currentChat);
            
            // –ó–∞–∫—Ä–µ–ø–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            await db.pinMessage(currentChat, messageId);
            pinnedMessage = message;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            await displayPinnedMessage(currentChat);
            showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ', 'success');
        }

        async function unpinMessage() {
            if (!currentChat || !pinnedMessage) return;
            
            await db.unpinMessage(currentChat);
            pinnedMessage = null;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            pinnedMessageContainer.style.display = 'none';
            showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–∫—Ä–µ–ø–ª–µ–Ω–æ', 'info');
        }

        function showInChat() {
            if (!pinnedMessage) return;
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            const messageElement = document.querySelector(`[data-message-id="${pinnedMessage.id}"]`);
            if (messageElement) {
                messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
                messageElement.style.animation = 'pulse 2s';
                setTimeout(() => {
                    messageElement.style.animation = '';
                }, 2000);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª—è –≤–≤–æ–¥–∞
        function expandInput() {
            if (isInputExpanded) return;
            
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const actionBtns = document.querySelectorAll('.action-btn');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
            messageInput.classList.remove('collapsed');
            messageInput.classList.add('expanded');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–æ–∫
            sendBtn.classList.add('pulsing');
            
            actionBtns.forEach(btn => {
                if (btn.id !== 'file-btn') {
                    btn.classList.add('visible');
                }
            });
            
            isInputExpanded = true;
        }

        function collapseInput() {
            if (!isInputExpanded) return;
            
            const messageInput = document.getElementById('message-input');
            const sendBtn = document.getElementById('send-btn');
            const actionBtns = document.querySelectorAll('.action-btn');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∂–∞—Ç–∏—è
            messageInput.classList.remove('expanded');
            messageInput.classList.add('collapsed');
            
            // –°–±—Ä–æ—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–Ω–æ–ø–æ–∫
            sendBtn.classList.remove('pulsing');
            
            actionBtns.forEach(btn => {
                if (btn.id !== 'file-btn') {
                    btn.classList.remove('visible');
                }
            });
            
            isInputExpanded = false;
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
        function showDeleteConfirmation(message) {
            deleteConfirmationModal.style.display = 'flex';
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
            contextMenuMessage = message;
        }

        function hideDeleteConfirmation() {
            deleteConfirmationModal.style.display = 'none';
            contextMenuMessage = null;
        }

        async function confirmDelete() {
            if (!contextMenuMessage) return;
            
            // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
            // –í Supabase —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ delete –∑–∞–ø—Ä–æ—Å
            const { error } = await supabase
                .from('messages')
                .delete()
                .eq('id', contextMenuMessage.id);
            
            if (error) {
                console.error('Error deleting message:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
                return;
            }
            
            // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –æ—Ç–∫—Ä–µ–ø–ª—è–µ–º –µ–≥–æ
            if (pinnedMessage && pinnedMessage.id === contextMenuMessage.id) {
                await unpinMessage();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            if (currentChat) {
                loadChatMessages(currentChat);
            }
            
            showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ', 'success');
            hideDeleteConfirmation();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é —Å–æ–æ–±—â–µ–Ω–∏—è
        function showMessageContextMenu(e, message) {
            e.preventDefault();
            e.stopPropagation();
            
            contextMenuMessage = message;
            
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –º–µ–Ω—é
            const existingMenu = document.querySelector('.message-context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
            const contextMenu = document.createElement('div');
            contextMenu.className = 'message-context-menu';
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –≤—ã—Ö–æ–¥–∏–ª–æ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
            let posX = e.pageX;
            let posY = e.pageY;
            
            // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –º–µ–Ω—é
            const menuWidth = 220;
            const menuHeight = 400;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –≤—ã—Ö–æ–¥–∏–ª–æ –∑–∞ –ø—Ä–∞–≤—ã–π –∫—Ä–∞–π
            if (posX + menuWidth > window.innerWidth) {
                posX = window.innerWidth - menuWidth - 10;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –º–µ–Ω—é –Ω–µ –≤—ã—Ö–æ–¥–∏–ª–æ –∑–∞ –Ω–∏–∂–Ω–∏–π –∫—Ä–∞–π
            if (posY + menuHeight > window.innerHeight) {
                posY = window.innerHeight - menuHeight - 10;
            }
            
            contextMenu.style.left = posX + 'px';
            contextMenu.style.top = posY + 'px';
            
            const isSent = message.sender_id === currentUser.id;
            
            // –°–æ–∑–¥–∞–µ–º –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é
            const menuItems = [];
            
            // –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
            menuItems.push(`
                <button class="message-context-menu-item" data-action="add-reaction">
                    <i class="fas fa-smile"></i>
                    –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
                </button>
            `);
            
            // –û—Ç–≤–µ—Ç–∏—Ç—å
            menuItems.push(`
                <button class="message-context-menu-item" data-action="reply">
                    <i class="fas fa-reply"></i>
                    –û—Ç–≤–µ—Ç–∏—Ç—å
                </button>
            `);
            
            menuItems.push('<div class="message-context-menu-divider"></div>');
            
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
            if (isSent) {
                menuItems.push(`
                    <button class="message-context-menu-item" data-action="edit">
                        <i class="fas fa-edit"></i>
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                `);
            }
            
            // –ü–µ—Ä–µ—Å–ª–∞—Ç—å
            menuItems.push(`
                <button class="message-context-menu-item" data-action="forward">
                    <i class="fas fa-share"></i>
                    –ü–µ—Ä–µ—Å–ª–∞—Ç—å
                    </button>
            `);
            
            // –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
            if (message.text) {
                menuItems.push(`
                    <button class="message-context-menu-item" data-action="copy-text">
                        <i class="fas fa-copy"></i>
                        –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
                    </button>
                `);
            }
            
            menuItems.push('<div class="message-context-menu-divider"></div>');
            
            // –ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —É–∂–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ)
            if (!message.pinned) {
                menuItems.push(`
                    <button class="message-context-menu-item" data-action="pin">
                        <i class="fas fa-thumbtack"></i>
                        –ó–∞–∫—Ä–µ–ø–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
                    </button>
                `);
            }
            
            // –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
            menuItems.push(`
                <button class="message-context-menu-item" data-action="mark-unread">
                    <i class="fas fa-envelope"></i>
                    –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
                </button>
            `);
            
            // –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
            menuItems.push(`
                <button class="message-context-menu-item" data-action="copy-link">
                    <i class="fas fa-link"></i>
                    –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
            `);
            
            menuItems.push('<div class="message-context-menu-divider"></div>');
            
            // –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è (–∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç)
            menuItems.push(`
                <button class="message-context-menu-item report" data-action="report">
                    <i class="fas fa-flag"></i>
                    –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è
                </button>
            `);
            
            // –£–¥–∞–ª–∏—Ç—å (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π, –∫—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç)
            if (isSent) {
                menuItems.push(`
                    <button class="message-context-menu-item delete" data-action="delete">
                        <i class="fas fa-trash"></i>
                        –£–¥–∞–ª–∏—Ç—å
                    </button>
                `);
            }
            
            contextMenu.innerHTML = menuItems.join('');
            
            document.body.appendChild(contextMenu);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
            contextMenu.querySelectorAll('.message-context-menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const action = this.dataset.action;
                    handleMessageContextAction(action, message);
                    contextMenu.remove();
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            function closeMenu() {
                contextMenu.remove();
                document.removeEventListener('click', closeMenu);
                document.removeEventListener('contextmenu', closeMenu);
            }
            
            // –î–∞–µ–º –≤—Ä–µ–º—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ–±—ã—Ç–∏—è
            setTimeout(() => {
                document.addEventListener('click', closeMenu);
                document.addEventListener('contextmenu', closeMenu);
            }, 100);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–µ–π—Å—Ç–≤–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function handleMessageContextAction(action, message) {
            switch(action) {
                case 'add-reaction':
                    showReactionPicker(message);
                    break;
                case 'reply':
                    replyToMessage(message.id);
                    break;
                case 'edit':
                    editMessage(message);
                    break;
                case 'forward':
                    forwardMessage(message);
                    break;
                case 'copy-text':
                    copyMessageText(message);
                    break;
                case 'pin':
                    pinMessage(message.id);
                    break;
                case 'mark-unread':
                    markMessageAsUnread(message);
                    break;
                case 'copy-link':
                    copyMessageLink(message);
                    break;
                case 'report':
                    reportMessage(message);
                    break;
                case 'delete':
                    showDeleteConfirmation(message);
                    break;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        function showReactionPicker(message) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–∫—Ü–∏–∏
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∞–∫—Ü–∏—é –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è', 'info');
        }

        function editMessage(message) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
            const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:', message.text);
            if (newText && newText !== message.text) {
                db.updateMessage(message.id, { text: newText });
                loadChatMessages(currentChat);
                showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ', 'success');
            }
        }

        function forwardMessage(message) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
            showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è', 'info');
        }

        function copyMessageText(message) {
            navigator.clipboard.writeText(message.text)
                .then(() => showNotification('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success'))
                .catch(() => showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç', 'error'));
        }

        function markMessageAsUnread(message) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–≥–æ
            showNotification('–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–º–µ—á–µ–Ω–æ –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ', 'info');
        }

        function copyMessageLink(message) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const link = `${window.location.origin}/message/${message.id}`;
            navigator.clipboard.writeText(link)
                .then(() => showNotification('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success'))
                .catch(() => showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É', 'error'));
        }

        function reportMessage(message) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–±—ã
            showNotification('–ñ–∞–ª–æ–±–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞', 'info');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–≥–Ω–∞—Ç –∑–∞–≥—Ä—É–∂–µ–Ω! –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ Supabase');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è
                const savedUser = localStorage.getItem('ignat_current_user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        messengerContainer.style.display = 'block';
                        landingPage.style.display = 'none';
                        authContainer.style.display = 'none';
                        
                        document.getElementById('user-avatar').textContent = currentUser.avatar;
                        document.getElementById('user-name').textContent = currentUser.username;
                        
                        if (currentUser.custom_avatar) {
                            document.getElementById('user-avatar').style.backgroundImage = `url(${currentUser.custom_avatar})`;
                            document.getElementById('user-avatar').textContent = '';
                        }
                        
                        loadUserChats();
                        startOnlineUpdates();
                        showNotification(`–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${currentUser.username}!`, 'success');
                    } catch (e) {
                        console.error('Error restoring session:', e);
                        landingPage.style.display = 'block';
                        authContainer.style.display = 'none';
                        messengerContainer.style.display = 'none';
                    }
                } else {
                    landingPage.style.display = 'block';
                    authContainer.style.display = 'none';
                    messengerContainer.style.display = 'none';
                }
            }, 2000);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º—É
            const savedTheme = getTheme();
            setTheme(savedTheme);
            document.getElementById('theme-toggle').checked = savedTheme === 'light';
            document.getElementById('theme-setting').checked = savedTheme === 'light';
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–æ–∏
            const savedWallpaper = getWallpaper();
            setWallpaper(savedWallpaper);
            
            // –î–æ–±–∞–≤–ª—è–µ–º ripple —ç—Ñ—Ñ–µ–∫—Ç –∫–æ –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º
            const buttons = document.querySelectorAll('.btn-3d, .auth-btn, .action-btn, .send-btn, .close-modal');
            buttons.forEach(button => {
                button.addEventListener('click', createRipple);
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —Ç–µ–º—ã
            document.getElementById('theme-toggle').addEventListener('change', function() {
                const theme = this.checked ? 'light' : 'dark';
                setTheme(theme);
            });

            document.getElementById('theme-setting').addEventListener('change', function() {
                const theme = this.checked ? 'light' : 'dark';
                setTheme(theme);
                document.getElementById('theme-toggle').checked = this.checked;
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.getElementById('landing-login-btn').addEventListener('click', function() {
                landingPage.style.display = 'none';
                authContainer.style.display = 'flex';
            });

            document.getElementById('landing-register-btn').addEventListener('click', function() {
                landingPage.style.display = 'none';
                authContainer.style.display = 'flex';
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
            });

            document.getElementById('hero-register-btn').addEventListener('click', function() {
                landingPage.style.display = 'none';
                authContainer.style.display = 'flex';
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
            });

            document.getElementById('learn-more-btn').addEventListener('click', function() {
                showNotification('–ò–≥–Ω–∞—Ç - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º, –±—ã—Å—Ç—Ä–æ–π –¥–æ—Å—Ç–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —É–¥–æ–±–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º!', 'info');
            });

            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            document.getElementById('auth-back-btn').addEventListener('click', function() {
                authContainer.style.display = 'none';
                landingPage.style.display = 'block';
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏ –≤—Ö–æ–¥–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('switch-to-register').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
            });

            document.getElementById('switch-to-login').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('register-form').style.display = 'none';
                document.getElementById('login-form').style.display = 'block';
            });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
            document.getElementById('register-username').addEventListener('input', async function() {
                const username = this.value;
                const isValid = validateUsername(username);
                
                document.getElementById('register-username-error').style.display = isValid ? 'none' : 'flex';
                
                if (isValid) {
                    const existingUser = await db.getUserByUsername(username);
                    if (existingUser) {
                        document.getElementById('register-username-error').textContent = '–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É–∂–µ –∑–∞–Ω—è—Ç–æ';
                        document.getElementById('register-username-error').style.display = 'flex';
                        document.getElementById('register-username-success').style.display = 'none';
                        this.className = 'invalid';
                    } else {
                        document.getElementById('register-username-success').style.display = 'flex';
                        this.className = 'valid';
                    }
                } else {
                    document.getElementById('register-username-success').style.display = 'none';
                }
                
                validateRegistrationForm();
            });

            document.getElementById('register-password').addEventListener('input', function() {
                const password = this.value;
                const passwordCheck = checkPasswordStrength(password);
                
                updatePasswordRequirements(passwordCheck.requirements);
                updatePasswordStrength(passwordCheck.strength);
                
                document.getElementById('register-password-error').style.display = 
                    passwordCheck.strength >= 3 ? 'none' : 'flex';
                
                validateRegistrationForm();
            });

            document.getElementById('confirm-password').addEventListener('input', function() {
                const password = document.getElementById('register-password').value;
                const confirmPassword = this.value;
                
                const isValid = password === confirmPassword && password !== '';
                
                document.getElementById('confirm-password-error').style.display = isValid ? 'none' : 'flex';
                
                validateRegistrationForm();
            });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
            document.getElementById('login-username').addEventListener('input', validateLoginForm);
            document.getElementById('login-password').addEventListener('input', validateLoginForm);

            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            document.getElementById('register-btn').addEventListener('click', async function() {
                if (!validateRegistrationForm()) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ', 'error');
                    return;
                }

                const username = document.getElementById('register-username').value.trim();
                const password = document.getElementById('register-password').value;

                const existingUser = await db.getUserByUsername(username);
                if (existingUser) {
                    showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç', 'error');
                    return;
                }

                const user = {
                    id: 'user_' + Date.now(),
                    username: username,
                    password: password,
                    avatar: username.substring(0, 2).toUpperCase(),
                    is_online: true,
                    last_seen: new Date().toISOString(),
                    custom_avatar: null,
                    status: 'online',
                    bio: '',
                    created_at: new Date().toISOString()
                };

                try {
                    const newUser = await db.addUser(user);
                    currentUser = newUser;
                    
                    await db.saveSettings(currentUser.id, {
                        theme: getTheme(),
                        notifications: 'all'
                    });
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
                    localStorage.setItem('ignat_current_user', JSON.stringify(currentUser));
                    
                    authContainer.style.display = 'none';
                    messengerContainer.style.display = 'block';
                    
                    document.getElementById('user-avatar').textContent = currentUser.avatar;
                    document.getElementById('user-name').textContent = currentUser.username;
                    
                    await loadUserChats();
                    startOnlineUpdates();
                    
                    showNotification('–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ò–≥–Ω–∞—Ç!', 'success');
                } catch (error) {
                    console.error('Error creating user:', error);
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞', 'error');
                }
            });

            // –í—Ö–æ–¥
            document.getElementById('login-btn').addEventListener('click', async function() {
                if (!validateLoginForm()) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ', 'error');
                    return;
                }

                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;

                const user = await db.getUserByUsername(username);
                if (!user || user.password !== password) {
                    showNotification('–ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
                    return;
                }

                currentUser = user;
                await db.updateUser(user.id, { 
                    is_online: true,
                    last_seen: new Date().toISOString()
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–µ—Å—Å–∏—é
                localStorage.setItem('ignat_current_user', JSON.stringify(currentUser));
                
                authContainer.style.display = 'none';
                messengerContainer.style.display = 'block';
                
                document.getElementById('user-avatar').textContent = currentUser.avatar;
                document.getElementById('user-name').textContent = currentUser.username;
                
                if (currentUser.custom_avatar) {
                    document.getElementById('user-avatar').style.backgroundImage = `url(${currentUser.custom_avatar})`;
                    document.getElementById('user-avatar').textContent = '';
                }
                
                await loadUserChats();
                startOnlineUpdates();
                
                showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}!`, 'success');
            });

            // –í—ã—Ö–æ–¥
            document.getElementById('logout-btn').addEventListener('click', async function() {
                if (currentUser) {
                    await db.updateUser(currentUser.id, { 
                        is_online: false,
                        last_seen: new Date().toISOString()
                    });
                    localStorage.removeItem('ignat_current_user');
                }
                
                currentUser = null;
                currentChat = null;
                messengerContainer.style.display = 'none';
                landingPage.style.display = 'block';
                
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
                
                document.getElementById('login-username').value = '';
                document.getElementById('login-password').value = '';
                document.getElementById('register-username').value = '';
                document.getElementById('register-password').value = '';
                document.getElementById('confirm-password').value = '';
                
                showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞', 'info');
            });

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            document.getElementById('settings-btn').addEventListener('click', async function() {
                if (!currentUser) return;
                
                const settings = await db.getSettings(currentUser.id);
                document.getElementById('notifications-setting').value = settings.notifications || 'all';
                document.getElementById('sound-setting').value = settings.sound || 'enabled';
                document.getElementById('privacy-setting').value = settings.privacy || 'all';
                document.getElementById('last-seen-setting').value = settings.lastSeen || 'all';
                document.getElementById('display-name').value = currentUser.username;
                document.getElementById('user-bio').value = currentUser.bio || '';
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
                document.querySelectorAll('.status-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.status === currentUser.status) {
                        option.classList.add('selected');
                    }
                });
                
                document.querySelectorAll('.avatar-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.avatar === currentUser.avatar) {
                        option.classList.add('selected');
                    }
                });
                
                // –í—ã–±–æ—Ä –æ–±–æ–µ–≤
                const currentWallpaper = getWallpaper();
                document.querySelectorAll('.wallpaper-option').forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.wallpaper === currentWallpaper) {
                        option.classList.add('selected');
                    }
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –æ–±–æ–µ–≤
                document.querySelectorAll('.wallpaper-option').forEach(option => {
                    option.addEventListener('click', function() {
                        document.querySelectorAll('.wallpaper-option').forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                loadBlockedUsersList();
                
                settingsWindow.style.display = 'flex';
            });

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –ø–∞–Ω–µ–ª–µ–π
                    document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ –∏ –ø–∞–Ω–µ–ª–∏
                    this.classList.add('active');
                    document.getElementById(`${tabId}-panel`).classList.add('active');
                });
            });

            // –í—ã–±–æ—Ä —Å—Ç–∞—Ç—É—Å–∞
            document.querySelectorAll('.status-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.status-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // –í—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∞
            document.querySelectorAll('.avatar-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∫–∏
            document.getElementById('avatar-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB', 'error');
                        return;
                    }
                    
                    if (!file.type.startsWith('image/')) {
                        showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const avatarUrl = event.target.result;
                        const newAvatarOption = document.createElement('div');
                        newAvatarOption.className = 'avatar-option selected';
                        newAvatarOption.style.backgroundImage = `url(${avatarUrl})`;
                        newAvatarOption.title = '–í–∞—à–∞ –∞–≤–∞—Ç–∞—Ä–∫–∞';
                        
                        const avatarOptions = document.querySelector('.avatar-options');
                        avatarOptions.innerHTML = '';
                        avatarOptions.appendChild(newAvatarOption);
                        
                        currentUser.custom_avatar = avatarUrl;
                        currentUser.avatar = 'IMG';
                        db.updateUser(currentUser.id, {
                            custom_avatar: avatarUrl,
                            avatar: 'IMG'
                        });
                        
                        document.getElementById('user-avatar').style.backgroundImage = `url(${avatarUrl})`;
                        document.getElementById('user-avatar').textContent = '';
                        
                        showNotification('–ê–≤–∞—Ç–∞—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('save-settings-btn').addEventListener('click', async function() {
                if (!currentUser) return;
                
                const notifications = document.getElementById('notifications-setting').value;
                const sound = document.getElementById('sound-setting').value;
                const privacy = document.getElementById('privacy-setting').value;
                const lastSeen = document.getElementById('last-seen-setting').value;
                const displayName = document.getElementById('display-name').value;
                const userBio = document.getElementById('user-bio').value;
                const selectedStatus = document.querySelector('.status-option.selected');
                const selectedAvatar = document.querySelector('.avatar-option.selected');
                const selectedWallpaper = document.querySelector('.wallpaper-option.selected');
                
                if (selectedStatus) {
                    currentUser.status = selectedStatus.dataset.status;
                    await db.updateUser(currentUser.id, {
                        status: currentUser.status
                    });
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
                    const statusDot = document.querySelector('.user-status .status-dot');
                    const userAvatar = document.getElementById('user-avatar');
                    
                    userAvatar.className = `avatar ${currentUser.status}`;
                    
                    let statusText = '';
                    switch(currentUser.status) {
                        case 'online':
                            statusText = '–æ–Ω–ª–∞–π–Ω';
                            statusDot.style.background = 'var(--online-green)';
                            break;
                        case 'idle':
                            statusText = '–Ω–µ –∞–∫—Ç–∏–≤–µ–Ω';
                            statusDot.style.background = 'var(--idle-yellow)';
                            break;
                        case 'dnd':
                            statusText = '–Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å';
                            statusDot.style.background = 'var(--dnd-red)';
                            break;
                        case 'offline':
                            statusText = '–Ω–µ –≤ —Å–µ—Ç–∏';
                            statusDot.style.background = 'var(--offline-gray)';
                            break;
                    }
                    
                    document.querySelector('.user-status').innerHTML = `<span class="status-dot"></span> ${statusText}`;
                }
                
                if (selectedAvatar && selectedAvatar.dataset.avatar) {
                    currentUser.avatar = selectedAvatar.dataset.avatar;
                    currentUser.custom_avatar = null;
                    await db.updateUser(currentUser.id, {
                        avatar: currentUser.avatar,
                        custom_avatar: null
                    });
                    
                    document.getElementById('user-avatar').style.backgroundImage = '';
                    document.getElementById('user-avatar').textContent = currentUser.avatar;
                }
                
                if (displayName && displayName !== currentUser.username) {
                    currentUser.username = displayName;
                    await db.updateUser(currentUser.id, {
                        username: displayName
                    });
                    
                    document.getElementById('user-name').textContent = displayName;
                }
                
                if (userBio !== currentUser.bio) {
                    currentUser.bio = userBio;
                    await db.updateUser(currentUser.id, {
                        bio: userBio
                    });
                }
                
                if (selectedWallpaper) {
                    setWallpaper(selectedWallpaper.dataset.wallpaper);
                }
                
                await db.saveSettings(currentUser.id, {
                    notifications: notifications,
                    sound: sound,
                    privacy: privacy,
                    lastSeen: lastSeen
                });
                
                settingsWindow.style.display = 'none';
                showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
            });

            document.getElementById('clear-data-btn').addEventListener('click', function() {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                    db.clearDatabase();
                    showNotification('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!', 'success');
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                }
            });

            document.getElementById('cancel-settings-btn').addEventListener('click', function() {
                settingsWindow.style.display = 'none';
            });

            document.getElementById('close-settings-btn').addEventListener('click', function() {
                settingsWindow.style.display = 'none';
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
            document.getElementById('file-btn').addEventListener('click', function() {
                document.getElementById('file-upload-modal').style.display = 'flex';
                setupFileUpload();
            });

            document.getElementById('file-input').addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    for (let file of files) {
                        addFileToUploadList(file);
                    }
                    this.value = '';
                }
            });

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
            document.getElementById('send-btn').addEventListener('click', sendMessage);
            document.getElementById('message-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª—è –≤–≤–æ–¥–∞
            document.getElementById('message-input').addEventListener('focus', function() {
                expandInput();
            });

            document.getElementById('message-input').addEventListener('blur', function() {
                if (this.value.trim() === '') {
                    // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–∂–∞—Ç–∏–µ–º, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –∫–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
                    clearTimeout(inputAnimationTimeout);
                    inputAnimationTimeout = setTimeout(() => {
                        collapseInput();
                    }, 300);
                }
            });

            document.getElementById('message-input').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞
                if (this.value.trim() !== '' && !isInputExpanded) {
                    expandInput();
                }
            });

            // –ü–æ–∏—Å–∫
            let searchTimeout;
            document.getElementById('global-search').addEventListener('input', function() {
                clearTimeout(searchTimeout);
                const searchTerm = this.value.trim();
                
                searchTimeout = setTimeout(async () => {
                    if (searchTerm.length === 0) {
                        await loadUserChats();
                        return;
                    }
                    
                    await searchUsers(searchTerm);
                }, 300);
            });

            // –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('voice-record-btn').addEventListener('mousedown', startVoiceRecording);
            document.getElementById('voice-record-btn').addEventListener('touchstart', startVoiceRecording);
            document.getElementById('voice-record-btn').addEventListener('mouseup', stopVoiceRecording);
            document.getElementById('voice-record-btn').addEventListener('touchend', stopVoiceRecording);
            document.addEventListener('mouseup', cancelVoiceRecording);
            document.addEventListener('touchend', cancelVoiceRecording);

            // –ó–≤–æ–Ω–∫–∏
            document.getElementById('audio-call-btn').addEventListener('click', function() {
                if (!currentChat) {
                    showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –∑–≤–æ–Ω–∫–∞', 'error');
                    return;
                }
                startCall(false);
            });

            document.getElementById('video-call-btn').addEventListener('click', function() {
                if (!currentChat) {
                    showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –∑–≤–æ–Ω–∫–∞', 'error');
                    return;
                }
                startCall(true);
            });

            document.getElementById('end-call-btn').addEventListener('click', endCall);
            document.getElementById('end-audio-call-btn').addEventListener('click', endCall);
            document.getElementById('accept-call-btn').addEventListener('click', acceptCall);
            document.getElementById('decline-call-btn').addEventListener('click', declineCall);
            document.getElementById('notification-accept-btn').addEventListener('click', acceptCall);
            document.getElementById('notification-decline-btn').addEventListener('click', declineCall);

            document.getElementById('audio-toggle-btn').addEventListener('click', toggleAudio);
            document.getElementById('video-toggle-btn').addEventListener('click', toggleVideo);
            document.getElementById('audio-call-toggle-btn').addEventListener('click', toggleAudio);

            // –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            document.getElementById('unpin-message-btn').addEventListener('click', unpinMessage);
            document.getElementById('show-in-chat-btn').addEventListener('click', showInChat);

            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
            document.getElementById('cancel-delete-btn').addEventListener('click', hideDeleteConfirmation);
            document.getElementById('confirm-delete-btn').addEventListener('click', confirmDelete);

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('beforeunload', function() {
                if (currentUser) {
                    db.updateUser(currentUser.id, {
                        last_seen: new Date().toISOString()
                    });
                }
            });
        });

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Ç–∞–º–∏
        async function loadUserChats() {
            if (!currentUser) return;
            
            const container = document.getElementById('chats-list');
            const chats = await db.getUserChats(currentUser.id);
            
            container.innerHTML = '';
            
            if (chats.length === 0) {
                container.innerHTML = `
                    <div class="welcome-message">
                        <div class="welcome-title">–ù–µ—Ç —á–∞—Ç–æ–≤</div>
                        <div class="welcome-subtitle">–ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π —á–∞—Ç —Å –ø–æ–º–æ—â—å—é –ø–æ–∏—Å–∫–∞</div>
                    </div>
                `;
                return;
            }
            
            for (const chat of chats) {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${currentChat === chat.id ? 'active' : ''}`;
                
                if (chat.is_group) {
                    // –î–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤
                    chatItem.innerHTML = `
                        <div class="avatar" style="background: var(--accent-purple);"><i class="fas fa-users"></i></div>
                        <div class="chat-info">
                            <div class="chat-name">
                                ${chat.group_info.name}
                                <span style="font-size: 0.8rem; color: var(--text-gray);">@${chat.group_info.username}</span>
                            </div>
                            <div class="last-message">${chat.last_message || '–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç'}</div>
                        </div>
                        <div class="chat-time">${new Date(chat.last_message_time || chat.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
                    `;
                } else {
                    // –î–ª—è –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤
                    const otherUserId = chat.participants.find(id => id !== currentUser.id);
                    const otherUser = await db.getUserById(otherUserId);
                    
                    if (!otherUser) continue;
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
                    const isBlocked = await db.isUserBlocked(currentUser.id, otherUserId);
                    
                    let avatarContent = isBlocked ? '?' : otherUser.avatar;
                    let avatarStyle = '';
                    if (!isBlocked && otherUser.custom_avatar) {
                        avatarContent = '';
                        avatarStyle = `background-image: url(${otherUser.custom_avatar})`;
                    }
                    
                    chatItem.innerHTML = `
                        <div class="avatar ${isBlocked ? 'offline' : (isUserOnline(otherUser.last_seen) ? otherUser.status || 'online' : 'offline')}" style="${avatarStyle}">${avatarContent}</div>
                        <div class="chat-info">
                            <div class="chat-name">
                                ${isBlocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' : otherUser.username}
                            </div>
                            <div class="last-message">${chat.last_message || '–ß–∞—Ç –Ω–∞—á–∞—Ç'}</div>
                        </div>
                        <div class="chat-time">${new Date(chat.last_message_time || chat.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}</div>
                    `;
                }
                
                chatItem.addEventListener('click', function() {
                    loadChat(chat.id);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                if (!chat.is_group) {
                    const otherUserId = chat.participants.find(id => id !== currentUser.id);
                    const isBlocked = await db.isUserBlocked(currentUser.id, otherUserId);
                    
                    chatItem.addEventListener('contextmenu', function(e) {
                        e.preventDefault();
                        showChatContextMenu(e, chat.id, otherUserId, isBlocked);
                    });
                }
                
                container.appendChild(chatItem);
            }
        }

        function showChatContextMenu(e, chatId, otherUserId, isBlocked) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
            const existingMenu = document.querySelector('.context-menu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            const contextMenu = document.createElement('div');
            contextMenu.className = 'context-menu';
            contextMenu.style.position = 'fixed';
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            contextMenu.style.background = 'var(--card-blue)';
            contextMenu.style.border = '1px solid rgba(107, 99, 181, 0.3)';
            contextMenu.style.borderRadius = '10px';
            contextMenu.style.padding = '10px';
            contextMenu.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.3)';
            contextMenu.style.zIndex = '1000';
            contextMenu.style.backdropFilter = 'blur(10px)';
            
            if (isBlocked) {
                contextMenu.innerHTML = `
                    <button class="context-menu-item" data-action="unblock" data-user-id="${otherUserId}">
                        <i class="fas fa-unlock"></i> –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                `;
            } else {
                contextMenu.innerHTML = `
                    <button class="context-menu-item" data-action="block" data-user-id="${otherUserId}">
                        <i class="fas fa-ban"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                `;
            }
            
            document.body.appendChild(contextMenu);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
            contextMenu.querySelectorAll('.context-menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const action = this.dataset.action;
                    const userId = this.dataset.userId;
                    
                    if (action === 'block') {
                        blockUser(userId);
                    } else if (action === 'unblock') {
                        unblockUser(userId);
                    }
                    
                    contextMenu.remove();
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', function closeMenu() {
                contextMenu.remove();
                document.removeEventListener('click', closeMenu);
            });
        }

        async function blockUser(userId) {
            if (!currentUser) return;
            
            await db.blockUser(currentUser.id, userId);
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'info');
            await loadUserChats();
            
            // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —á–∞—Ç —Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
            if (currentChat) {
                const chat = await db.getChat(currentChat);
                if (chat && !chat.is_group) {
                    const otherUserId = chat.participants.find(id => id !== currentUser.id);
                    if (otherUserId === userId) {
                        loadChat(currentChat);
                    }
                }
            }
        }

        async function unblockUser(userId) {
            if (!currentUser) return;
            
            await db.unblockUser(currentUser.id, userId);
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'info');
            await loadUserChats();
            
            // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —á–∞—Ç —Å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
            if (currentChat) {
                const chat = await db.getChat(currentChat);
                if (chat && !chat.is_group) {
                    const otherUserId = chat.participants.find(id => id !== currentUser.id);
                    if (otherUserId === userId) {
                        loadChat(currentChat);
                    }
                }
            }
        }

        function loadBlockedUsersList() {
            if (!currentUser) return;
            
            const container = document.getElementById('blocked-users-list');
            
            container.innerHTML = '';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            db.getBlockedUsers(currentUser.id).then(async blockedUserIds => {
                if (blockedUserIds.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-gray);">–ù–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
                    return;
                }
                
                for (const userId of blockedUserIds) {
                    const user = await db.getUserById(userId);
                    if (!user) continue;
                    
                    const blockedUserElement = document.createElement('div');
                    blockedUserElement.className = 'blocked-user';
                    blockedUserElement.innerHTML = `
                        <div class="blocked-user-info">
                            <div class="blocked-user-avatar">${user.avatar}</div>
                            <div class="blocked-user-name">${user.username}</div>
                        </div>
                        <button class="unblock-btn" data-user-id="${userId}">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
                    `;
                    
                    container.appendChild(blockedUserElement);
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
                    blockedUserElement.querySelector('.unblock-btn').addEventListener('click', function() {
                        unblockUser(userId);
                    });
                }
            });
        }

        async function searchUsers(query) {
            const users = await db.searchUsers(query);
            const filteredUsers = users.filter(user => user.id !== currentUser.id);
            displaySearchResults(filteredUsers);
        }

        function displaySearchResults(users) {
            const container = document.getElementById('chats-list');
            container.innerHTML = '';
            
            if (users.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: var(--text-gray); padding: 20px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            users.forEach(async user => {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
                const isBlocked = await db.isUserBlocked(currentUser.id, user.id);
                
                let avatarContent = isBlocked ? '?' : user.avatar;
                let avatarStyle = '';
                if (!isBlocked && user.custom_avatar) {
                    avatarContent = '';
                    avatarStyle = `background-image: url(${user.custom_avatar})`;
                }
                
                const userItem = document.createElement('div');
                userItem.className = 'chat-item';
                userItem.innerHTML = `
                    <div class="avatar ${isBlocked ? 'offline' : (isUserOnline(user.last_seen) ? user.status || 'online' : 'offline')}" style="${avatarStyle}">${avatarContent}</div>
                    <div class="chat-info">
                        <div class="chat-name">
                            ${isBlocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' : user.username}
                        </div>
                        <div class="last-message">
                            ${isBlocked ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : (isUserOnline(user.last_seen) ? '–æ–Ω–ª–∞–π–Ω' : `–±—ã–ª(–∞) ${formatLastSeen(user.last_seen)}`)}
                        </div>
                    </div>
                    <div class="unread-badge">–ß–∞—Ç</div>
                `;
                
                userItem.addEventListener('click', function() {
                    if (!isBlocked) {
                        startChatWithUser(user.id);
                        document.getElementById('global-search').value = '';
                    }
                });
                
                container.appendChild(userItem);
            });
        }

        async function startChatWithUser(userId) {
            let chat = await db.findChatBetweenUsers(currentUser.id, userId);
            
            if (!chat) {
                const otherUser = await db.getUserById(userId);
                chat = {
                    id: 'chat_' + Date.now(),
                    participants: [currentUser.id, userId],
                    participant_names: {
                        [currentUser.id]: currentUser.username,
                        [userId]: otherUser.username
                    },
                    last_message: '',
                    last_message_time: new Date().toISOString(),
                    is_group: false,
                    created_at: new Date().toISOString()
                };
                await db.addChat(chat);
            }
            
            await loadChat(chat.id);
            await loadUserChats();
        }

        async function loadChat(chatId) {
            currentChat = chatId;
            const chat = await db.getChat(chatId);
            
            if (chat.is_group) {
                // –î–ª—è –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤
                document.getElementById('current-chat-avatar').innerHTML = '<i class="fas fa-users"></i>';
                document.getElementById('current-chat-avatar').style.background = 'var(--accent-purple)';
                document.getElementById('current-chat-name').textContent = chat.group_info.name;
                document.getElementById('current-chat-status').textContent = '–ì—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç';
            } else {
                // –î–ª—è –ª–∏—á–Ω—ã—Ö —á–∞—Ç–æ–≤
                const otherUserId = chat.participants.find(id => id !== currentUser.id);
                const otherUser = await db.getUserById(otherUserId);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
                const isBlocked = await db.isUserBlocked(currentUser.id, otherUserId);
                
                let avatarContent = isBlocked ? '?' : otherUser.avatar;
                let avatarStyle = '';
                if (!isBlocked && otherUser.custom_avatar) {
                    avatarContent = '';
                    avatarStyle = `background-image: url(${otherUser.custom_avatar})`;
                }
                
                document.getElementById('current-chat-avatar').style = avatarStyle;
                document.getElementById('current-chat-avatar').textContent = avatarContent;
                document.getElementById('current-chat-avatar').className = `avatar ${isBlocked ? 'offline' : (isUserOnline(otherUser.last_seen) ? otherUser.status || 'online' : 'offline')}`;
                document.getElementById('current-chat-name').textContent = isBlocked ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å' : otherUser.username;
                
                const statusText = isBlocked ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : 
                    (isUserOnline(otherUser.last_seen) ? 
                        `<span class="status-dot"></span> ${otherUser.status === 'online' ? '–æ–Ω–ª–∞–π–Ω' : otherUser.status === 'idle' ? '–Ω–µ –∞–∫—Ç–∏–≤–µ–Ω' : otherUser.status === 'dnd' ? '–Ω–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å' : '–Ω–µ –≤ —Å–µ—Ç–∏'}` : 
                        `–±—ã–ª(–∞) ${formatLastSeen(otherUser.last_seen)}`);
                document.getElementById('current-chat-status').innerHTML = statusText;
            }
            
            document.getElementById('message-input').disabled = false;
            document.getElementById('send-btn').disabled = false;
            
            await loadChatMessages(chatId);
            await displayPinnedMessage(chatId);
        }

        async function loadChatMessages(chatId) {
            const container = document.getElementById('chat-messages');
            const messages = await db.getChatMessages(chatId);
            const voiceMessages = await db.getChatVoiceMessages(chatId);
            
            container.innerHTML = '';
            
            if (messages.length === 0 && voiceMessages.length === 0) {
                container.innerHTML = `
                    <div class="welcome-message">
                        <div class="welcome-title">–ß–∞—Ç –Ω–∞—á–∞—Ç</div>
                        <div class="welcome-subtitle">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ!</div>
                    </div>
                `;
                return;
            }
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            const allMessages = [...messages, ...voiceMessages];
            allMessages.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
            
            allMessages.forEach(message => {
                if (message.type === 'voice') {
                    addVoiceMessageToChat(message, false);
                } else {
                    addMessageToChat(message, false);
                }
            });
            
            scrollToBottom();
        }

        function addMessageToChat(message, animate = true) {
            const container = document.getElementById('chat-messages');
            const isSent = message.sender_id === currentUser.id;
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isSent ? 'sent' : 'received'} ${message.pinned ? 'pinned' : ''} ${message.reply_to ? 'reply' : ''} ${message.uploading ? 'uploading' : ''}`;
            messageElement.dataset.messageId = message.id;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
            messageElement.addEventListener('contextmenu', function(e) {
                showMessageContextMenu(e, message);
            });
            
            const time = new Date(message.created_at).toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let messageContent = message.text;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (message.reply_to) {
                const repliedMessage = getMessageById(message.reply_to);
                if (repliedMessage) {
                    messageContent = `
                        <div class="reply-indicator">
                            <div class="reply-sender">${repliedMessage.sender_id === currentUser.id ? '–í—ã' : repliedMessage.sender_name}</div>
                            <div>${repliedMessage.text || '–°–æ–æ–±—â–µ–Ω–∏–µ'}</div>
                        </div>
                        ${messageContent}
                    `;
                }
            }
            
            if (message.file) {
                messageContent = `
                    <div>${message.text || '–§–∞–π–ª'}</div>
                    <div class="file-message">
                        <div class="file-icon">
                            <i class="fas fa-${getFileIcon(message.file.type)}"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">${message.file.name}</div>
                            <div class="file-size">${formatFileSize(message.file.size)}</div>
                        </div>
                        <button class="download-btn" onclick="downloadFile('${message.file.url}', '${message.file.name}')">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                `;
            }
            
            if (message.uploading) {
                messageContent = `
                    <div class="message-content">
                        <div class="spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...</div>
                    </div>
                    <div class="upload-progress">
                        <div class="upload-progress-bar" style="width: ${message.progress || 0}%"></div>
                    </div>
                `;
            }
            
            messageElement.innerHTML = `
                <div>${messageContent}</div>
                <div class="message-time">${time}</div>
                ${isSent ? '<div class="message-status"><i class="fas fa-check-double"></i> –ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>' : ''}
                
            `;
            
            if (animate) {
                messageElement.style.animation = 'messageAppear 0.4s ease-out';
            }
            
            container.appendChild(messageElement);
            scrollToBottom();
        }

        function addVoiceMessageToChat(voiceMessage, animate = true) {
            const container = document.getElementById('chat-messages');
            const isSent = voiceMessage.sender_id === currentUser.id;
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isSent ? 'sent' : 'received'}`;
            messageElement.dataset.voiceMessageId = voiceMessage.id;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
            messageElement.addEventListener('contextmenu', function(e) {
                showMessageContextMenu(e, voiceMessage);
            });
            
            const time = new Date(voiceMessage.created_at).toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≤–æ–ª–Ω—ã
            const waveformData = voiceMessage.waveform || generateWaveformData(50);
            const waveformBars = waveformData.map(height => 
                `<div class="voice-wave-bar" style="height: ${height}px;"></div>`
            ).join('');
            
            messageElement.innerHTML = `
                <div class="voice-message-container">
                    <div class="voice-message-player">
                        <button class="voice-play-btn" onclick="playVoiceMessage('${voiceMessage.id}')">
                            <i class="fas fa-play"></i>
                        </button>
                        <div class="voice-waveform">
                            ${waveformBars}
                        </div>
                        <div class="voice-duration">${formatTime(voiceMessage.duration || 0)}</div>
                    </div>
                    <div class="voice-controls">
                        <select class="voice-speed-selector" onchange="changePlaybackSpeed('${voiceMessage.id}', this.value)">
                            <option value="1">1x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2x</option>
                        </select>
                    </div>
                </div>
                <div class="message-time">${time}</div>
                ${isSent ? '<div class="message-status"><i class="fas fa-check-double"></i> –ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>' : ''}
            `;
            
            if (animate) {
                messageElement.style.animation = 'messageAppear 0.4s ease-out';
            }
            
            container.appendChild(messageElement);
            scrollToBottom();
        }

        function getMessageById(messageId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null
            return null;
        }

        function replyToMessage(messageId) {
            const message = getMessageById(messageId);
            if (!message) return;
            
            replyingToMessage = message;
            document.getElementById('message-input').placeholder = `–û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ ${message.sender_id === currentUser.id ? '–≤–∞–º' : message.sender_name}...`;
            document.getElementById('message-input').focus();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞
            showReplyIndicator(message);
        }

        function showReplyIndicator(message) {
            // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            const existingIndicator = document.querySelector('.reply-indicator-active');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            const indicator = document.createElement('div');
            indicator.className = 'reply-indicator reply-indicator-active';
            indicator.style.margin = '10px 30px';
            indicator.style.padding = '10px 15px';
            indicator.style.borderRadius = '10px';
            indicator.style.background = 'var(--input-blue)';
            indicator.style.borderLeft = '3px solid var(--primary-blue)';
            indicator.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div class="reply-sender">–û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ ${message.sender_id === currentUser.id ? '–≤–∞–º' : message.sender_name}</div>
                        <div>${message.text || '–°–æ–æ–±—â–µ–Ω–∏–µ'}</div>
                    </div>
                    <button class="message-action" onclick="cancelReply()" style="background: none; border: none; color: var(--text-gray); cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            const chatInputContainer = document.querySelector('.chat-input-container');
            chatInputContainer.parentNode.insertBefore(indicator, chatInputContainer);
        }

        function cancelReply() {
            replyingToMessage = null;
            document.getElementById('message-input').placeholder = '–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...';
            
            // –£–¥–∞–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–≤–µ—Ç–∞
            const indicator = document.querySelector('.reply-indicator-active');
            if (indicator) {
                indicator.remove();
            }
        }

        function getFileIcon(fileType) {
            if (fileType.startsWith('image/')) return 'file-image';
            if (fileType.startsWith('video/')) return 'file-video';
            if (fileType.startsWith('audio/')) return 'file-audio';
            if (fileType.includes('pdf')) return 'file-pdf';
            if (fileType.includes('word')) return 'file-word';
            if (fileType.includes('excel')) return 'file-excel';
            if (fileType.includes('zip')) return 'file-archive';
            return 'file';
        }

        async function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (!text && filesToSend.length === 0 && !replyingToMessage) return;
            
            const message = {
                id: 'msg_' + Date.now(),
                chat_id: currentChat,
                sender_id: currentUser.id,
                sender_name: currentUser.username,
                text: text,
                reply_to: replyingToMessage ? replyingToMessage.id : null,
                created_at: new Date().toISOString()
            };
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            if (filesToSend.length > 0) {
                for (const file of filesToSend) {
                    const fileMessage = {
                        ...message,
                        id: 'msg_' + Date.now() + '_' + Math.random(),
                        text: '',
                        file: {
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            url: URL.createObjectURL(file)
                        }
                    };
                    
                    await db.addMessage(fileMessage);
                    addMessageToChat(fileMessage, true);
                }
                
                // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                filesToSend = [];
                document.getElementById('file-previews').innerHTML = '';
            }
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (text) {
                await db.addMessage(message);
                addMessageToChat(message, true);
            }
            
            await db.updateChat(currentChat, {
                last_message: text || '–§–∞–π–ª',
                last_message_time: new Date().toISOString()
            });
            
            input.value = '';
            input.style.height = 'auto';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (replyingToMessage) {
                cancelReply();
            }
            
            // –°–∂–∏–º–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            collapseInput();
            
            await loadUserChats();
        }

        function setupFileUpload() {
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.multiple = true;
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
            document.getElementById('browse-files-btn').addEventListener('click', function() {
                fileInput.click();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤
            fileInput.addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    for (let file of files) {
                        addFileToUploadList(file);
                    }
                }
                fileInput.value = '';
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è drag and drop
            dropZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropZone.classList.add('active');
            });
            
            dropZone.addEventListener('dragleave', function() {
                dropZone.classList.remove('active');
            });
            
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dropZone.classList.remove('active');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    for (let file of files) {
                        addFileToUploadList(file);
                    }
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∞–π–ª–æ–≤
            document.getElementById('send-files-btn').addEventListener('click', function() {
                if (filesToSend.length > 0) {
                    document.getElementById('file-upload-modal').style.display = 'none';
                    sendMessage();
                } else {
                    showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'error');
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—Ç–º–µ–Ω—ã
            document.getElementById('cancel-file-upload-btn').addEventListener('click', function() {
                document.getElementById('file-upload-modal').style.display = 'none';
                filesToSend = [];
                document.getElementById('file-previews').innerHTML = '';
            });
            
            document.getElementById('close-file-upload-btn').addEventListener('click', function() {
                document.getElementById('file-upload-modal').style.display = 'none';
                filesToSend = [];
                document.getElementById('file-previews').innerHTML = '';
            });
        }

        function addFileToUploadList(file) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 10MB)
            if (file.size > 10 * 1024 * 1024) {
                showNotification(`–§–∞–π–ª ${file.name} —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB`, 'error');
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ —Å–ø–∏—Å–æ–∫
            filesToSend.push(file);
            
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–≤—å—é —Ñ–∞–π–ª–∞
            const preview = document.createElement('div');
            preview.className = 'file-preview';
            
            let previewContent = '';
            if (file.type.startsWith('image/')) {
                previewContent = `
                    <img src="${URL.createObjectURL(file)}" alt="${file.name}">
                `;
            } else {
                previewContent = `
                    <div class="file-icon">
                        <i class="fas fa-${getFileIcon(file.type)}"></i>
                    </div>
                `;
            }
            
            preview.innerHTML = `
                ${previewContent}
                <div class="file-preview-info">
                    <div class="file-preview-name">${file.name}</div>
                    <div class="file-preview-size">${formatFileSize(file.size)}</div>
                </div>
                <button class="remove-file" data-file-name="${file.name}">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.getElementById('file-previews').appendChild(preview);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞
            preview.querySelector('.remove-file').addEventListener('click', function() {
                const fileName = this.dataset.fileName;
                filesToSend = filesToSend.filter(f => f.name !== fileName);
                preview.remove();
            });
        }

        function downloadFile(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function scrollToBottom() {
            const container = document.getElementById('chat-messages');
            container.scrollTop = container.scrollHeight;
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        async function startVoiceRecording(e) {
            e.preventDefault();
            
            if (!currentChat) {
                showNotification('–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è', 'error');
                return;
            }
            
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                // –°–æ–∑–¥–∞–µ–º MediaRecorder
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏
                mediaRecorder.start();
                isRecording = true;
                recordingStartTime = Date.now();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                document.getElementById('voice-record-btn').classList.add('recording');
                showRecordingIndicator();
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–∏
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                // –¢–∞–π–º–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–ø–∏—Å–∏
                recordingTimer = setInterval(updateRecordingTime, 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', error);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É', 'error');
            }
        }

        function stopVoiceRecording() {
            if (!isRecording) return;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–ø–∏—Å—å
            mediaRecorder.stop();
            isRecording = false;
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
            clearInterval(recordingTimer);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            document.getElementById('voice-record-btn').classList.remove('recording');
            hideRecordingIndicator();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
            mediaRecorder.onstop = async () => {
                // –°–æ–∑–¥–∞–µ–º Blob –∏–∑ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                
                // –°–æ–∑–¥–∞–µ–º URL –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                const audioUrl = URL.createObjectURL(audioBlob);
                
                // –í—ã—á–∏—Å–ª—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏
                const duration = Math.floor((Date.now() - recordingStartTime) / 1000);
                
                // –°–æ–∑–¥–∞–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                const voiceMessage = {
                    id: 'voice_' + Date.now(),
                    chat_id: currentChat,
                    sender_id: currentUser.id,
                    sender_name: currentUser.username,
                    type: 'voice',
                    audio_url: audioUrl,
                    duration: duration,
                    waveform: generateWaveformData(50),
                    created_at: new Date().toISOString()
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                await db.addVoiceMessage(voiceMessage);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ —á–∞—Ç
                addVoiceMessageToChat(voiceMessage, true);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —á–∞—Ç
                await db.updateChat(currentChat, {
                    last_message: '–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
                    last_message_time: new Date().toISOString()
                });
                
                await loadUserChats();
                
                // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
                mediaRecorder.stream.getTracks().forEach(track => track.stop());
            };
        }

        function cancelVoiceRecording(e) {
            // –û—Ç–º–µ–Ω—è–µ–º –∑–∞–ø–∏—Å—å, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª –ø–∞–ª–µ—Ü/–º—ã—à—å –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∫–Ω–æ–ø–∫–∏
            if (isRecording) {
                const voiceBtn = document.getElementById('voice-record-btn');
                const rect = voiceBtn.getBoundingClientRect();
                const isInside = (
                    e.clientX >= rect.left &&
                    e.clientX <= rect.right &&
                    e.clientY >= rect.top &&
                    e.clientY <= rect.bottom
                );
                
                if (!isInside) {
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–ø–∏—Å—å
                    mediaRecorder.stop();
                    isRecording = false;
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä
                    clearInterval(recordingTimer);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    document.getElementById('voice-record-btn').classList.remove('recording');
                    hideRecordingIndicator();
                    
                    // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());
                    
                    showNotification('–ó–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞', 'info');
                }
            }
        }

        function showRecordingIndicator() {
            const container = document.getElementById('chat-messages');
            
            const recordingElement = document.createElement('div');
            recordingElement.className = 'voice-recording-indicator';
            recordingElement.id = 'recording-indicator';
            recordingElement.innerHTML = `
                <div class="recording-dot"></div>
                <div class="recording-time" id="recording-time">00:00</div>
                <div class="recording-cancel-hint">–û—Ç–ø—É—Å—Ç–∏—Ç–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, —Å–º–∞—Ö–Ω–∏—Ç–µ –¥–ª—è –æ—Ç–º–µ–Ω—ã</div>
            `;
            
            container.appendChild(recordingElement);
            scrollToBottom();
        }

        function hideRecordingIndicator() {
            const recordingElement = document.getElementById('recording-indicator');
            if (recordingElement) {
                recordingElement.remove();
            }
        }

        function updateRecordingTime() {
            const recordingTimeElement = document.getElementById('recording-time');
            if (recordingTimeElement) {
                const elapsedSeconds = Math.floor((Date.now() - recordingStartTime) / 1000);
                recordingTimeElement.textContent = formatTime(elapsedSeconds);
            }
        }

        function playVoiceMessage(voiceMessageId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            showNotification('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è', 'info');
        }

        function changePlaybackSpeed(voiceMessageId, speed) {
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –º–µ–Ω—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
            console.log(`–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –¥–ª—è ${voiceMessageId} –Ω–∞ ${speed}x`);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤
        async function startCall(isVideo) {
            if (!currentChat) return;
            
            try {
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
                const constraints = {
                    audio: true,
                    video: isVideo
                };
                
                localStream = await navigator.mediaDevices.getUserMedia(constraints);
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–≤–æ–Ω–∫–∞
                isVideoCall = isVideo;
                setupCallInterface(isVideo);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–≤–æ–Ω–∫–∞
                callContainer.style.display = 'flex';
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebRTC
                // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–≤–æ–Ω–∫–∞
                if (isVideo) {
                    document.getElementById('local-video').srcObject = localStream;
                }
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –∑–≤–æ–Ω–∫–∞
                startCallTimer();
                
                showNotification(`–ó–≤–æ–Ω–æ–∫ ${isVideo ? '–≤–∏–¥–µ–æ' : '–∞—É–¥–∏–æ'} –Ω–∞—á–∞—Ç`, 'info');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º:', error);
                showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ/–º–∏–∫—Ä–æ—Ñ–æ–Ω—É', 'error');
            }
        }

        function setupCallInterface(isVideo) {
            if (isVideo) {
                document.getElementById('video-call-container').style.display = 'flex';
                document.getElementById('audio-call-container').style.display = 'none';
                document.getElementById('incoming-call-container').style.display = 'none';
            } else {
                document.getElementById('video-call-container').style.display = 'none';
                document.getElementById('audio-call-container').style.display = 'flex';
                document.getElementById('incoming-call-container').style.display = 'none';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const chat = db.getChat(currentChat);
                if (chat && !chat.is_group) {
                    const otherUserId = chat.participants.find(id => id !== currentUser.id);
                    const otherUser = db.getUserById(otherUserId);
                    if (otherUser) {
                        document.getElementById('call-user-avatar').textContent = otherUser.avatar;
                        document.getElementById('call-user-name').textContent = otherUser.username;
                    }
                }
            }
        }

        function startCallTimer() {
            callStartTime = Date.now();
            callTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - callStartTime) / 1000);
                document.getElementById('call-timer').textContent = formatTime(elapsed);
            }, 1000);
        }

        function endCall() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
            }
            
            if (callTimer) {
                clearInterval(callTimer);
                callTimer = null;
            }
            
            callContainer.style.display = 'none';
            isInCall = false;
            
            showNotification('–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω', 'info');
        }

        function acceptCall() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–≤–æ–Ω–∫–∞
            incomingCallNotification.style.display = 'none';
            setupCallInterface(isVideoCall);
            callContainer.style.display = 'flex';
            startCallTimer();
            isInCall = true;
        }

        function declineCall() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞
            incomingCallNotification.style.display = 'none';
            callContainer.style.display = 'none';
            showNotification('–ó–≤–æ–Ω–æ–∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω', 'info');
        }

        function toggleAudio() {
            if (!localStream) return;
            
            const audioTracks = localStream.getAudioTracks();
            if (audioTracks.length > 0) {
                isAudioMuted = !isAudioMuted;
                audioTracks.forEach(track => {
                    track.enabled = !isAudioMuted;
                });
                
                const audioBtn = document.getElementById('audio-toggle-btn');
                audioBtn.innerHTML = isAudioMuted ? '<i class="fas fa-microphone-slash"></i>' : '<i class="fas fa-microphone"></i>';
                audioBtn.title = isAudioMuted ? '–í–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω' : '–í—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω';
                
                showNotification(isAudioMuted ? '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤—ã–∫–ª—é—á–µ–Ω' : '–ú–∏–∫—Ä–æ—Ñ–æ–Ω –≤–∫–ª—é—á–µ–Ω', 'info');
            }
        }

        function toggleVideo() {
            if (!localStream) return;
            
            const videoTracks = localStream.getVideoTracks();
            if (videoTracks.length > 0) {
                isVideoMuted = !isVideoMuted;
                videoTracks.forEach(track => {
                    track.enabled = !isVideoMuted;
                });
                
                const videoBtn = document.getElementById('video-toggle-btn');
                videoBtn.innerHTML = isVideoMuted ? '<i class="fas fa-video-slash"></i>' : '<i class="fas fa-video"></i>';
                videoBtn.title = isVideoMuted ? '–í–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ' : '–í—ã–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ';
                
                showNotification(isVideoMuted ? '–í–∏–¥–µ–æ –≤—ã–∫–ª—é—á–µ–Ω–æ' : '–í–∏–¥–µ–æ –≤–∫–ª—é—á–µ–Ω–æ', 'info');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
        function startOnlineUpdates() {
            if (!currentUser) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            updateInterval = setInterval(async () => {
                if (currentUser) {
                    await db.updateUser(currentUser.id, {
                        last_seen: new Date().toISOString()
                    });
                }
            }, 30000);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞ (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
        function simulateIncomingCall() {
            if (!currentChat) return;
            
            const chat = db.getChat(currentChat);
            if (chat && !chat.is_group) {
                const otherUserId = chat.participants.find(id => id !== currentUser.id);
                const otherUser = db.getUserById(otherUserId);
                
                if (otherUser) {
                    document.getElementById('notification-call-avatar').textContent = otherUser.avatar;
                    document.getElementById('notification-call-name').textContent = otherUser.username;
                    document.getElementById('incoming-call-avatar').textContent = otherUser.avatar;
                    document.getElementById('incoming-call-name').textContent = otherUser.username;
                    
                    incomingCallNotification.style.display = 'flex';
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        if (incomingCallNotification.style.display === 'flex') {
                            incomingCallNotification.style.display = 'none';
                        }
                    }, 30000);
                }
            }
        }

        // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞
        function demoIncomingCall() {
            simulateIncomingCall();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        console.log('–ò–≥–Ω–∞—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
    </script>
</body>
</html>
